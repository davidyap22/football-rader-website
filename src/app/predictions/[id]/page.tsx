'use client';

import { useState, useEffect, useRef, useCallback } from 'react';
import Link from 'next/link';
import { useParams, useSearchParams, useRouter } from 'next/navigation';
import { supabase, Prematch, OddsHistory, Moneyline1x2Prediction, OverUnderPrediction, HandicapPrediction, ProfitSummary, getUserSubscription, UserSubscription, MatchPrediction, getMatchPrediction, TeamLineup, getFixtureLineups, FixturePlayer, LiveSignals, getLiveSignals, FixtureEvent, getFixtureEvents } from '@/lib/supabase';
import { User } from '@supabase/supabase-js';
import { RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, Legend, ResponsiveContainer } from 'recharts';
import FlagIcon, { LANGUAGES } from "@/components/FlagIcon";

// Helper function to parse LiveSignals data from database
const parseLiveSignals = (data: LiveSignals | null): LiveSignals | null => {
  if (!data) return null;
  const parseArray = (val: unknown): number[] | null => {
    if (val === null || val === undefined) return null;
    if (Array.isArray(val)) return val.map(v => typeof v === 'number' ? v : parseFloat(String(v)));
    if (typeof val === 'string') {
      try {
        const parsed = JSON.parse(val);
        if (Array.isArray(parsed)) return parsed.map(v => typeof v === 'number' ? v : parseFloat(String(v)));
      } catch { return null; }
    }
    return null;
  };
  const parseNumber = (val: unknown): number | null => {
    if (val === null || val === undefined) return null;
    if (typeof val === 'number') return val;
    if (typeof val === 'string') {
      const num = parseFloat(val.replace('%', ''));
      return isNaN(num) ? null : num;
    }
    return null;
  };
  return {
    ...data,
    fair_odds_1x2: parseArray(data.fair_odds_1x2),
    market_odds_1x2: parseArray(data.market_odds_1x2),
    expected_value_1x2: parseNumber(data.expected_value_1x2),
    recommended_stake_1x2: parseNumber(data.recommended_stake_1x2),
    fair_odds_ou: parseArray(data.fair_odds_ou),
    market_odds_ou: parseArray(data.market_odds_ou),
    expected_value_ou: parseNumber(data.expected_value_ou),
    recommended_stake_ou: parseNumber(data.recommended_stake_ou),
    fair_odds_hdp: parseArray(data.fair_odds_hdp),
    market_odds_hdp: parseArray(data.market_odds_hdp),
    expected_value_hdp: parseNumber(data.expected_value_hdp),
    recommended_stake_hdp: parseNumber(data.recommended_stake_hdp),
    clock: parseNumber(data.clock),
  };
};

// Translations
const translations: Record<string, Record<string, string>> = {
  EN: {
    home: "Home", predictions: "Predictions", leagues: "Leagues", performance: "AI Performance", community: "Community", news: "News", solution: "Solution", pricing: "Pricing",
    login: "Log In", getStarted: "Get Started", backToPredictions: "Back to Predictions",
    preMatchOdds: "Pre-match Odds", liveOdds: "Live Odds", finalOdds: "Final Odds", odds: "Odds",
    viewOddsHistory: "View Odds History", oddsHistory: "Odds History", noOddsData: "No odds data available",
    home_team: "Home", away_team: "Away", draw: "Draw", over: "Over", under: "Under",
    live: "LIVE", fullTime: "Full Time", notStarted: "Not Started", win: "WIN",
    aiPredictions: "AI Predictions", poweredByAI: "Powered by AI", selectBettingStyle: "Select Your Betting Style",
    matchResult: "Match Result (1X2)", overUnder: "Over/Under 2.5 Goals", asianHandicap: "Asian Handicap -0.5",
    disclaimer: "These predictions are generated by AI and should be used for informational purposes only. Please gamble responsibly. 18+",
    footer: "18+ | Gambling involves risk. Please gamble responsibly.",
    allRights: "Â© 2026 OddsFlow. All rights reserved.",
    refreshIn: "Refresh in", noHistory: "No odds history available",
    teamComparison: "Team Comparison", aiAnalysis: "AI-powered analysis",
    teamLineups: "Team Lineups", startingXI: "Starting XI & Formation",
    lineupNotAvailable: "Lineup data not available yet",
    lineupNotAvailableDesc: "Team lineups are usually announced 1 hour before kick-off. Please check back closer to match time.",
    matchEvents: "Match Events", eventsTimeline: "Goals, Cards & Substitutions",
    noEvents: "No events yet", noEventsDesc: "Events will appear here once the match starts.",
    goal: "Goal", yellowCard: "Yellow Card", redCard: "Red Card", substitution: "Substitution", penalty: "Penalty", ownGoal: "Own Goal", var: "VAR", missedPenalty: "Missed Penalty",
    tabOdds: "Odds & AI", tabComparison: "Comparison", tabLineups: "Lineups", tabEvents: "Events",
  },
  ES: {
    home: "Inicio", predictions: "Predicciones", leagues: "Ligas", performance: "Rendimiento IA", community: "Comunidad", news: "Noticias", solution: "SoluciÃ³n", pricing: "Precios",
    login: "Iniciar SesiÃ³n", getStarted: "Comenzar", backToPredictions: "Volver a Predicciones",
    preMatchOdds: "Cuotas Pre-partido", liveOdds: "Cuotas en Vivo", finalOdds: "Cuotas Finales", odds: "Cuotas",
    viewOddsHistory: "Ver Historial de Cuotas", oddsHistory: "Historial de Cuotas", noOddsData: "No hay datos de cuotas disponibles",
    home_team: "Local", away_team: "Visitante", draw: "Empate", over: "MÃ¡s", under: "Menos",
    live: "EN VIVO", fullTime: "Final", notStarted: "No Iniciado", win: "GANÃ“",
    aiPredictions: "Predicciones IA", poweredByAI: "Impulsado por IA", selectBettingStyle: "Selecciona tu Estilo de Apuesta",
    matchResult: "Resultado del Partido (1X2)", overUnder: "MÃ¡s/Menos 2.5 Goles", asianHandicap: "HÃ¡ndicap AsiÃ¡tico -0.5",
    disclaimer: "Estas predicciones son generadas por IA y deben usarse solo con fines informativos. Por favor juega responsablemente. 18+",
    footer: "18+ | El juego implica riesgo. Por favor juega responsablemente.",
    allRights: "Â© 2026 OddsFlow. Todos los derechos reservados.",
    refreshIn: "Actualiza en", noHistory: "No hay historial de cuotas disponible",
    teamComparison: "ComparaciÃ³n de Equipos", aiAnalysis: "AnÃ¡lisis impulsado por IA",
    teamLineups: "Alineaciones", startingXI: "XI Titular y FormaciÃ³n",
    lineupNotAvailable: "AlineaciÃ³n no disponible aÃºn",
    lineupNotAvailableDesc: "Las alineaciones se anuncian normalmente 1 hora antes del inicio. Por favor, vuelve mÃ¡s tarde.",
    matchEvents: "Eventos del Partido", eventsTimeline: "Goles, Tarjetas y Sustituciones",
    noEvents: "Sin eventos aÃºn", noEventsDesc: "Los eventos aparecerÃ¡n aquÃ­ cuando comience el partido.",
    goal: "Gol", yellowCard: "Tarjeta Amarilla", redCard: "Tarjeta Roja", substitution: "SustituciÃ³n", penalty: "Penal", ownGoal: "Autogol", var: "VAR", missedPenalty: "Penal Fallado",
    tabOdds: "Cuotas & IA", tabComparison: "ComparaciÃ³n", tabLineups: "Alineaciones", tabEvents: "Eventos",
  },
  PT: {
    home: "InÃ­cio", predictions: "PrevisÃµes", leagues: "Ligas", performance: "Desempenho IA", community: "Comunidade", news: "NotÃ­cias", solution: "SoluÃ§Ã£o", pricing: "PreÃ§os",
    login: "Entrar", getStarted: "ComeÃ§ar", backToPredictions: "Voltar Ã s PrevisÃµes",
    preMatchOdds: "Odds PrÃ©-jogo", liveOdds: "Odds ao Vivo", finalOdds: "Odds Finais", odds: "Odds",
    viewOddsHistory: "Ver HistÃ³rico de Odds", oddsHistory: "HistÃ³rico de Odds", noOddsData: "Nenhum dado de odds disponÃ­vel",
    home_team: "Casa", away_team: "Fora", draw: "Empate", over: "Mais", under: "Menos",
    live: "AO VIVO", fullTime: "Final", notStarted: "NÃ£o Iniciado", win: "VITÃ“RIA",
    aiPredictions: "PrevisÃµes IA", poweredByAI: "Powered by IA", selectBettingStyle: "Selecione seu Estilo de Aposta",
    matchResult: "Resultado da Partida (1X2)", overUnder: "Mais/Menos 2.5 Gols", asianHandicap: "Handicap AsiÃ¡tico -0.5",
    disclaimer: "Estas previsÃµes sÃ£o geradas por IA e devem ser usadas apenas para fins informativos. Jogue com responsabilidade. 18+",
    footer: "18+ | O jogo envolve risco. Por favor, jogue com responsabilidade.",
    allRights: "Â© 2026 OddsFlow. Todos os direitos reservados.",
    refreshIn: "Atualiza em", noHistory: "Nenhum histÃ³rico de odds disponÃ­vel",
    teamComparison: "ComparaÃ§Ã£o de Equipes", aiAnalysis: "AnÃ¡lise com IA",
    teamLineups: "EscalaÃ§Ãµes", startingXI: "XI Titular e FormaÃ§Ã£o",
    lineupNotAvailable: "EscalaÃ§Ã£o ainda nÃ£o disponÃ­vel",
    lineupNotAvailableDesc: "As escalaÃ§Ãµes sÃ£o normalmente anunciadas 1 hora antes do jogo. Por favor, volte mais tarde.",
    matchEvents: "Eventos da Partida", eventsTimeline: "Gols, CartÃµes e SubstituiÃ§Ãµes",
    noEvents: "Sem eventos ainda", noEventsDesc: "Os eventos aparecerÃ£o aqui quando a partida comeÃ§ar.",
    goal: "Gol", yellowCard: "CartÃ£o Amarelo", redCard: "CartÃ£o Vermelho", substitution: "SubstituiÃ§Ã£o", penalty: "PÃªnalti", ownGoal: "Gol Contra", var: "VAR", missedPenalty: "PÃªnalti Perdido",
    tabOdds: "Odds & IA", tabComparison: "ComparaÃ§Ã£o", tabLineups: "EscalaÃ§Ãµes", tabEvents: "Eventos",
  },
  DE: {
    home: "Startseite", predictions: "Vorhersagen", leagues: "Ligen", performance: "KI-Leistung", community: "Community", news: "Nachrichten", solution: "LÃ¶sung", pricing: "Preise",
    login: "Anmelden", getStarted: "Loslegen", backToPredictions: "ZurÃ¼ck zu Vorhersagen",
    preMatchOdds: "Vorspiel-Quoten", liveOdds: "Live-Quoten", finalOdds: "Endquoten", odds: "Quoten",
    viewOddsHistory: "Quotenverlauf anzeigen", oddsHistory: "Quotenverlauf", noOddsData: "Keine Quotendaten verfÃ¼gbar",
    home_team: "Heim", away_team: "AuswÃ¤rts", draw: "Unentschieden", over: "Ãœber", under: "Unter",
    live: "LIVE", fullTime: "Endstand", notStarted: "Nicht gestartet", win: "SIEG",
    aiPredictions: "KI-Vorhersagen", poweredByAI: "Powered by KI", selectBettingStyle: "WÃ¤hlen Sie Ihren Wettstil",
    matchResult: "Spielergebnis (1X2)", overUnder: "Ãœber/Unter 2.5 Tore", asianHandicap: "Asiatisches Handicap -0.5",
    disclaimer: "Diese Vorhersagen werden von KI generiert und sollten nur zu Informationszwecken verwendet werden. Bitte spielen Sie verantwortungsvoll. 18+",
    footer: "18+ | GlÃ¼cksspiel birgt Risiken. Bitte spielen Sie verantwortungsvoll.",
    allRights: "Â© 2026 OddsFlow. Alle Rechte vorbehalten.",
    refreshIn: "Aktualisierung in", noHistory: "Kein Quotenverlauf verfÃ¼gbar",
    teamComparison: "Teamvergleich", aiAnalysis: "KI-gestÃ¼tzte Analyse",
    teamLineups: "Aufstellungen", startingXI: "Startelf & Formation",
    lineupNotAvailable: "Aufstellung noch nicht verfÃ¼gbar",
    lineupNotAvailableDesc: "Aufstellungen werden normalerweise 1 Stunde vor Anpfiff bekannt gegeben. Bitte spÃ¤ter wiederkommen.",
    matchEvents: "Spielereignisse", eventsTimeline: "Tore, Karten & Auswechslungen",
    noEvents: "Noch keine Ereignisse", noEventsDesc: "Ereignisse erscheinen hier, sobald das Spiel beginnt.",
    goal: "Tor", yellowCard: "Gelbe Karte", redCard: "Rote Karte", substitution: "Auswechslung", penalty: "Elfmeter", ownGoal: "Eigentor", var: "VAR", missedPenalty: "Verschossener Elfmeter",
    tabOdds: "Quoten & KI", tabComparison: "Vergleich", tabLineups: "Aufstellungen", tabEvents: "Ereignisse",
  },
  FR: {
    home: "Accueil", predictions: "PrÃ©dictions", leagues: "Ligues", performance: "Performance IA", community: "CommunautÃ©", news: "ActualitÃ©s", solution: "Solution", pricing: "Tarifs",
    login: "Connexion", getStarted: "Commencer", backToPredictions: "Retour aux PrÃ©dictions",
    preMatchOdds: "Cotes PrÃ©-match", liveOdds: "Cotes en Direct", finalOdds: "Cotes Finales", odds: "Cotes",
    viewOddsHistory: "Voir l'Historique des Cotes", oddsHistory: "Historique des Cotes", noOddsData: "Aucune donnÃ©e de cotes disponible",
    home_team: "Domicile", away_team: "ExtÃ©rieur", draw: "Nul", over: "Plus", under: "Moins",
    live: "EN DIRECT", fullTime: "Temps Plein", notStarted: "Non CommencÃ©", win: "VICTOIRE",
    aiPredictions: "PrÃ©dictions IA", poweredByAI: "PropulsÃ© par IA", selectBettingStyle: "SÃ©lectionnez votre Style de Pari",
    matchResult: "RÃ©sultat du Match (1X2)", overUnder: "Plus/Moins 2.5 Buts", asianHandicap: "Handicap Asiatique -0.5",
    disclaimer: "Ces prÃ©dictions sont gÃ©nÃ©rÃ©es par l'IA et doivent Ãªtre utilisÃ©es Ã  titre informatif uniquement. Veuillez jouer de maniÃ¨re responsable. 18+",
    footer: "18+ | Les jeux d'argent comportent des risques. Jouez responsablement.",
    allRights: "Â© 2026 OddsFlow. Tous droits rÃ©servÃ©s.",
    refreshIn: "Actualisation dans", noHistory: "Aucun historique de cotes disponible",
    teamComparison: "Comparaison d'Ã‰quipes", aiAnalysis: "Analyse par IA",
    teamLineups: "Compositions", startingXI: "XI de dÃ©part & Formation",
    lineupNotAvailable: "Composition non disponible",
    lineupNotAvailableDesc: "Les compositions sont gÃ©nÃ©ralement annoncÃ©es 1 heure avant le coup d'envoi. Veuillez revenir plus tard.",
    matchEvents: "Ã‰vÃ©nements du Match", eventsTimeline: "Buts, Cartons & Remplacements",
    noEvents: "Pas d'Ã©vÃ©nements encore", noEventsDesc: "Les Ã©vÃ©nements apparaÃ®tront ici une fois le match commencÃ©.",
    goal: "But", yellowCard: "Carton Jaune", redCard: "Carton Rouge", substitution: "Remplacement", penalty: "PÃ©nalty", ownGoal: "But Contre Son Camp", var: "VAR", missedPenalty: "PÃ©nalty ManquÃ©",
    tabOdds: "Cotes & IA", tabComparison: "Comparaison", tabLineups: "Compositions", tabEvents: "Ã‰vÃ©nements",
  },
  JA: {
    home: "ãƒ›ãƒ¼ãƒ ", predictions: "äºˆæ¸¬", leagues: "ãƒªãƒ¼ã‚°", performance: "AIãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", community: "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£", news: "ãƒ‹ãƒ¥ãƒ¼ã‚¹", solution: "ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³", pricing: "æ–™é‡‘",
    login: "ãƒ­ã‚°ã‚¤ãƒ³", getStarted: "å§‹ã‚ã‚‹", backToPredictions: "äºˆæ¸¬ã«æˆ»ã‚‹",
    preMatchOdds: "è©¦åˆå‰ã‚ªãƒƒã‚º", liveOdds: "ãƒ©ã‚¤ãƒ–ã‚ªãƒƒã‚º", finalOdds: "æœ€çµ‚ã‚ªãƒƒã‚º", odds: "ã‚ªãƒƒã‚º",
    viewOddsHistory: "ã‚ªãƒƒã‚ºå±¥æ­´ã‚’è¦‹ã‚‹", oddsHistory: "ã‚ªãƒƒã‚ºå±¥æ­´", noOddsData: "ã‚ªãƒƒã‚ºãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“",
    home_team: "ãƒ›ãƒ¼ãƒ ", away_team: "ã‚¢ã‚¦ã‚§ã‚¤", draw: "å¼•ãåˆ†ã‘", over: "ã‚ªãƒ¼ãƒãƒ¼", under: "ã‚¢ãƒ³ãƒ€ãƒ¼",
    live: "ãƒ©ã‚¤ãƒ–", fullTime: "è©¦åˆçµ‚äº†", notStarted: "æœªé–‹å§‹", win: "å‹åˆ©",
    aiPredictions: "AIäºˆæ¸¬", poweredByAI: "AIã«ã‚ˆã‚‹", selectBettingStyle: "ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠ",
    matchResult: "è©¦åˆçµæœ (1X2)", overUnder: "ã‚ªãƒ¼ãƒãƒ¼/ã‚¢ãƒ³ãƒ€ãƒ¼ 2.5", asianHandicap: "ã‚¢ã‚¸ã‚¢ãƒ³ãƒãƒ³ãƒ‡ã‚£ã‚­ãƒ£ãƒƒãƒ— -0.5",
    disclaimer: "ã“ã‚Œã‚‰ã®äºˆæ¸¬ã¯AIã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã¦ãŠã‚Šã€æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚è²¬ä»»ã‚’æŒã£ã¦ãƒ—ãƒ¬ã‚¤ã—ã¦ãã ã•ã„ã€‚18æ­³ä»¥ä¸Š",
    footer: "18æ­³ä»¥ä¸Š | ã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã«ã¯ãƒªã‚¹ã‚¯ãŒä¼´ã„ã¾ã™ã€‚è²¬ä»»ã‚’æŒã£ã¦ãƒ—ãƒ¬ã‚¤ã—ã¦ãã ã•ã„ã€‚",
    allRights: "Â© 2026 OddsFlow. å…¨è‘—ä½œæ¨©æ‰€æœ‰ã€‚",
    refreshIn: "æ›´æ–°ã¾ã§", noHistory: "ã‚ªãƒƒã‚ºå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“",
    teamComparison: "ãƒãƒ¼ãƒ æ¯”è¼ƒ", aiAnalysis: "AIåˆ†æ",
    teamLineups: "ã‚¹ã‚¿ãƒ¡ãƒ³", startingXI: "å…ˆç™ºãƒ¡ãƒ³ãƒãƒ¼ & ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³",
    lineupNotAvailable: "ã‚¹ã‚¿ãƒ¡ãƒ³æœªç™ºè¡¨",
    lineupNotAvailableDesc: "ã‚¹ã‚¿ãƒ¡ãƒ³ã¯é€šå¸¸ã‚­ãƒƒã‚¯ã‚ªãƒ•ã®1æ™‚é–“å‰ã«ç™ºè¡¨ã•ã‚Œã¾ã™ã€‚å¾Œã»ã©ã”ç¢ºèªãã ã•ã„ã€‚",
    matchEvents: "è©¦åˆã‚¤ãƒ™ãƒ³ãƒˆ", eventsTimeline: "ã‚´ãƒ¼ãƒ«ã€ã‚«ãƒ¼ãƒ‰ã€äº¤ä»£",
    noEvents: "ã‚¤ãƒ™ãƒ³ãƒˆã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“", noEventsDesc: "è©¦åˆãŒå§‹ã¾ã‚‹ã¨ã‚¤ãƒ™ãƒ³ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚",
    goal: "ã‚´ãƒ¼ãƒ«", yellowCard: "ã‚¤ã‚¨ãƒ­ãƒ¼ã‚«ãƒ¼ãƒ‰", redCard: "ãƒ¬ãƒƒãƒ‰ã‚«ãƒ¼ãƒ‰", substitution: "äº¤ä»£", penalty: "ãƒšãƒŠãƒ«ãƒ†ã‚£", ownGoal: "ã‚ªã‚¦ãƒ³ã‚´ãƒ¼ãƒ«", var: "VAR", missedPenalty: "PKå¤±æ•—",
    tabOdds: "ã‚ªãƒƒã‚º & AI", tabComparison: "æ¯”è¼ƒ", tabLineups: "ã‚¹ã‚¿ãƒ¡ãƒ³", tabEvents: "ã‚¤ãƒ™ãƒ³ãƒˆ",
  },
  KO: {
    home: "í™ˆ", predictions: "ì˜ˆì¸¡", leagues: "ë¦¬ê·¸", performance: "AI ì„±ëŠ¥", community: "ì»¤ë®¤ë‹ˆí‹°", news: "ë‰´ìŠ¤", solution: "ì†”ë£¨ì…˜", pricing: "ê°€ê²©",
    login: "ë¡œê·¸ì¸", getStarted: "ì‹œì‘í•˜ê¸°", backToPredictions: "ì˜ˆì¸¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°",
    preMatchOdds: "ê²½ê¸° ì „ ë°°ë‹¹ë¥ ", liveOdds: "ë¼ì´ë¸Œ ë°°ë‹¹ë¥ ", finalOdds: "ìµœì¢… ë°°ë‹¹ë¥ ", odds: "ë°°ë‹¹ë¥ ",
    viewOddsHistory: "ë°°ë‹¹ë¥  ê¸°ë¡ ë³´ê¸°", oddsHistory: "ë°°ë‹¹ë¥  ê¸°ë¡", noOddsData: "ë°°ë‹¹ë¥  ë°ì´í„° ì—†ìŒ",
    home_team: "í™ˆ", away_team: "ì›ì •", draw: "ë¬´ìŠ¹ë¶€", over: "ì˜¤ë²„", under: "ì–¸ë”",
    live: "ë¼ì´ë¸Œ", fullTime: "ê²½ê¸° ì¢…ë£Œ", notStarted: "ì‹œì‘ ì „", win: "ìŠ¹ë¦¬",
    aiPredictions: "AI ì˜ˆì¸¡", poweredByAI: "AI ê¸°ë°˜", selectBettingStyle: "ë² íŒ… ìŠ¤íƒ€ì¼ ì„ íƒ",
    matchResult: "ê²½ê¸° ê²°ê³¼ (1X2)", overUnder: "ì˜¤ë²„/ì–¸ë” 2.5", asianHandicap: "ì•„ì‹œì•ˆ í•¸ë””ìº¡ -0.5",
    disclaimer: "ì´ ì˜ˆì¸¡ì€ AIì— ì˜í•´ ìƒì„±ë˜ì—ˆìœ¼ë©° ì •ë³´ ì œê³µ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì±…ì„ê° ìˆê²Œ í”Œë ˆì´í•˜ì„¸ìš”. 18ì„¸ ì´ìƒ",
    footer: "18ì„¸ ì´ìƒ | ë„ë°•ì—ëŠ” ìœ„í—˜ì´ ë”°ë¦…ë‹ˆë‹¤. ì±…ì„ê° ìˆê²Œ í”Œë ˆì´í•˜ì„¸ìš”.",
    allRights: "Â© 2026 OddsFlow. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ .",
    refreshIn: "ìƒˆë¡œê³ ì¹¨", noHistory: "ë°°ë‹¹ë¥  ê¸°ë¡ ì—†ìŒ",
    teamComparison: "íŒ€ ë¹„êµ", aiAnalysis: "AI ë¶„ì„",
    teamLineups: "ì„ ë°œ ë¼ì¸ì—…", startingXI: "ì„ ë°œ XI & í¬ë©”ì´ì…˜",
    lineupNotAvailable: "ë¼ì¸ì—… ë¯¸ë°œí‘œ",
    lineupNotAvailableDesc: "ë¼ì¸ì—…ì€ ì¼ë°˜ì ìœ¼ë¡œ ê²½ê¸° ì‹œì‘ 1ì‹œê°„ ì „ì— ë°œí‘œë©ë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.",
    matchEvents: "ê²½ê¸° ì´ë²¤íŠ¸", eventsTimeline: "ê³¨, ì¹´ë“œ & êµì²´",
    noEvents: "ì•„ì§ ì´ë²¤íŠ¸ ì—†ìŒ", noEventsDesc: "ê²½ê¸°ê°€ ì‹œì‘ë˜ë©´ ì—¬ê¸°ì— ì´ë²¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.",
    goal: "ê³¨", yellowCard: "ì˜ë¡œ ì¹´ë“œ", redCard: "ë ˆë“œ ì¹´ë“œ", substitution: "êµì²´", penalty: "í˜ë„í‹°", ownGoal: "ìì±…ê³¨", var: "VAR", missedPenalty: "í˜ë„í‹° ì‹¤íŒ¨",
    tabOdds: "ë°°ë‹¹ë¥  & AI", tabComparison: "ë¹„êµ", tabLineups: "ë¼ì¸ì—…", tabEvents: "ì´ë²¤íŠ¸",
  },
  'ä¸­æ–‡': {
    home: "é¦–é¡µ", predictions: "é¢„æµ‹", leagues: "è”èµ›", performance: "AIè¡¨ç°", community: "ç¤¾åŒº", news: "æ–°é—»", solution: "è§£å†³æ–¹æ¡ˆ", pricing: "ä»·æ ¼",
    login: "ç™»å½•", getStarted: "å¼€å§‹ä½¿ç”¨", backToPredictions: "è¿”å›é¢„æµ‹",
    preMatchOdds: "èµ›å‰èµ”ç‡", liveOdds: "å®æ—¶èµ”ç‡", finalOdds: "æœ€ç»ˆèµ”ç‡", odds: "èµ”ç‡",
    viewOddsHistory: "æŸ¥çœ‹èµ”ç‡å†å²", oddsHistory: "èµ”ç‡å†å²", noOddsData: "æš‚æ— èµ”ç‡æ•°æ®",
    home_team: "ä¸»é˜Ÿ", away_team: "å®¢é˜Ÿ", draw: "å¹³å±€", over: "å¤§", under: "å°",
    live: "ç›´æ’­", fullTime: "å…¨åœºç»“æŸ", notStarted: "æœªå¼€å§‹", win: "èƒœ",
    aiPredictions: "AIé¢„æµ‹", poweredByAI: "AIé©±åŠ¨", selectBettingStyle: "é€‰æ‹©æ‚¨çš„æŠ•æ³¨é£æ ¼",
    matchResult: "æ¯”èµ›ç»“æœ (1X2)", overUnder: "å¤§å°çƒ 2.5", asianHandicap: "äºšæ´²è®©çƒ -0.5",
    disclaimer: "è¿™äº›é¢„æµ‹ç”±AIç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒã€‚è¯·ç†æ€§æŠ•æ³¨ã€‚18+",
    footer: "18+ | åšå½©æœ‰é£é™©ï¼Œè¯·ç†æ€§æŠ•æ³¨ã€‚",
    allRights: "Â© 2026 OddsFlow. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚",
    refreshIn: "åˆ·æ–°å€’è®¡æ—¶", noHistory: "æš‚æ— èµ”ç‡å†å²",
    teamComparison: "çƒé˜Ÿå¯¹æ¯”", aiAnalysis: "AIåˆ†æ",
    teamLineups: "é¦–å‘é˜µå®¹", startingXI: "é¦–å‘11äºº & é˜µå‹",
    lineupNotAvailable: "é˜µå®¹æš‚æœªå…¬å¸ƒ",
    lineupNotAvailableDesc: "é¦–å‘é˜µå®¹é€šå¸¸åœ¨å¼€çƒå‰1å°æ—¶å…¬å¸ƒï¼Œè¯·ç¨åå†æŸ¥çœ‹ã€‚",
    matchEvents: "æ¯”èµ›äº‹ä»¶", eventsTimeline: "è¿›çƒã€çº¢é»„ç‰Œä¸æ¢äºº",
    noEvents: "æš‚æ— äº‹ä»¶", noEventsDesc: "æ¯”èµ›å¼€å§‹åäº‹ä»¶å°†åœ¨æ­¤æ˜¾ç¤ºã€‚",
    goal: "è¿›çƒ", yellowCard: "é»„ç‰Œ", redCard: "çº¢ç‰Œ", substitution: "æ¢äºº", penalty: "ç‚¹çƒ", ownGoal: "ä¹Œé¾™çƒ", var: "VAR", missedPenalty: "ç‚¹çƒæœªè¿›",
    tabOdds: "èµ”ç‡ & AI", tabComparison: "å¯¹æ¯”", tabLineups: "é˜µå®¹", tabEvents: "äº‹ä»¶",
  },
  'ç¹é«”': {
    home: "é¦–é ", predictions: "é æ¸¬", leagues: "è¯è³½", performance: "AIè¡¨ç¾", community: "ç¤¾å€", news: "æ–°è", solution: "è§£æ±ºæ–¹æ¡ˆ", pricing: "åƒ¹æ ¼",
    login: "ç™»å…¥", getStarted: "é–‹å§‹ä½¿ç”¨", backToPredictions: "è¿”å›é æ¸¬",
    preMatchOdds: "è³½å‰è³ ç‡", liveOdds: "å³æ™‚è³ ç‡", finalOdds: "æœ€çµ‚è³ ç‡", odds: "è³ ç‡",
    viewOddsHistory: "æŸ¥çœ‹è³ ç‡æ­·å²", oddsHistory: "è³ ç‡æ­·å²", noOddsData: "æš«ç„¡è³ ç‡è³‡æ–™",
    home_team: "ä¸»éšŠ", away_team: "å®¢éšŠ", draw: "å¹³å±€", over: "å¤§", under: "å°",
    live: "ç›´æ’­", fullTime: "å…¨å ´çµæŸ", notStarted: "æœªé–‹å§‹", win: "å‹",
    aiPredictions: "AIé æ¸¬", poweredByAI: "AIé©…å‹•", selectBettingStyle: "é¸æ“‡æ‚¨çš„æŠ•æ³¨é¢¨æ ¼",
    matchResult: "æ¯”è³½çµæœ (1X2)", overUnder: "å¤§å°çƒ 2.5", asianHandicap: "äºæ´²è®“çƒ -0.5",
    disclaimer: "é€™äº›é æ¸¬ç”±AIç”Ÿæˆï¼Œåƒ…ä¾›åƒè€ƒã€‚è«‹ç†æ€§æŠ•æ³¨ã€‚18+",
    footer: "18+ | åšå½©æœ‰é¢¨éšªï¼Œè«‹ç†æ€§æŠ•æ³¨ã€‚",
    allRights: "Â© 2026 OddsFlow. ä¿ç•™æ‰€æœ‰æ¬Šåˆ©ã€‚",
    refreshIn: "åˆ·æ–°å€’è¨ˆæ™‚", noHistory: "æš«ç„¡è³ ç‡æ­·å²",
    teamComparison: "çƒéšŠå°æ¯”", aiAnalysis: "AIåˆ†æ",
    teamLineups: "é¦–ç™¼é™£å®¹", startingXI: "é¦–ç™¼11äºº & é™£å‹",
    lineupNotAvailable: "é™£å®¹æš«æœªå…¬å¸ƒ",
    lineupNotAvailableDesc: "é¦–ç™¼é™£å®¹é€šå¸¸åœ¨é–‹çƒå‰1å°æ™‚å…¬å¸ƒï¼Œè«‹ç¨å¾Œå†æŸ¥çœ‹ã€‚",
    matchEvents: "æ¯”è³½äº‹ä»¶", eventsTimeline: "é€²çƒã€ç´…é»ƒç‰Œèˆ‡æ›äºº",
    noEvents: "æš«ç„¡äº‹ä»¶", noEventsDesc: "æ¯”è³½é–‹å§‹å¾Œäº‹ä»¶å°‡åœ¨æ­¤é¡¯ç¤ºã€‚",
    goal: "é€²çƒ", yellowCard: "é»ƒç‰Œ", redCard: "ç´…ç‰Œ", substitution: "æ›äºº", penalty: "é»çƒ", ownGoal: "çƒé¾çƒ", var: "VAR", missedPenalty: "é»çƒæœªé€²",
    tabOdds: "è³ ç‡ & AI", tabComparison: "å°æ¯”", tabLineups: "é™£å®¹", tabEvents: "äº‹ä»¶",
  },
  ID: {
    home: "Beranda", predictions: "Prediksi", leagues: "Liga", performance: "Performa AI", community: "Komunitas", news: "Berita", solution: "Solusi", pricing: "Harga",
    login: "Masuk", getStarted: "Mulai", backToPredictions: "Kembali ke Prediksi",
    preMatchOdds: "Odds Pra-pertandingan", liveOdds: "Odds Langsung", finalOdds: "Odds Akhir", odds: "Odds",
    viewOddsHistory: "Lihat Riwayat Odds", oddsHistory: "Riwayat Odds", noOddsData: "Tidak ada data odds tersedia",
    home_team: "Tim Tuan Rumah", away_team: "Tim Tamu", draw: "Seri", over: "Lebih", under: "Kurang",
    live: "LANGSUNG", fullTime: "Selesai", notStarted: "Belum Mulai", win: "MENANG",
    aiPredictions: "Prediksi AI", poweredByAI: "Didukung AI", selectBettingStyle: "Pilih Gaya Taruhan Anda",
    matchResult: "Hasil Pertandingan (1X2)", overUnder: "Over/Under 2.5 Gol", asianHandicap: "Handicap Asia -0.5",
    disclaimer: "Prediksi ini dihasilkan oleh AI dan hanya untuk tujuan informasi. Harap bertaruh dengan bijak. 18+",
    footer: "18+ | Perjudian melibatkan risiko. Harap bertaruh dengan bijak.",
    allRights: "Â© 2026 OddsFlow. Hak cipta dilindungi.",
    refreshIn: "Segarkan dalam", noHistory: "Tidak ada riwayat odds",
    teamComparison: "Perbandingan Tim", aiAnalysis: "Analisis bertenaga AI",
    teamLineups: "Susunan Pemain", startingXI: "Starting XI & Formasi",
    lineupNotAvailable: "Data susunan pemain belum tersedia",
    lineupNotAvailableDesc: "Susunan pemain biasanya diumumkan 1 jam sebelum kick-off. Silakan periksa kembali nanti.",
    matchEvents: "Peristiwa Pertandingan", eventsTimeline: "Gol, Kartu & Pergantian Pemain",
    noEvents: "Belum ada peristiwa", noEventsDesc: "Peristiwa akan muncul di sini saat pertandingan dimulai.",
    goal: "Gol", yellowCard: "Kartu Kuning", redCard: "Kartu Merah", substitution: "Pergantian", penalty: "Penalti", ownGoal: "Gol Bunuh Diri", var: "VAR", missedPenalty: "Penalti Gagal",
    tabOdds: "Odds & AI", tabComparison: "Perbandingan", tabLineups: "Susunan", tabEvents: "Peristiwa",
  },
};

// Betting personality types - maps to ai_model in database
const PERSONALITIES = [
  {
    id: 'aggressive',
    aiModel: 'aggressive model',
    name: 'Aggressive',
    nameZh: 'æ”»å‡»å‹',
    icon: 'ğŸ”¥',
    description: 'High risk, high reward. Favors home wins and over goals.',
    color: 'from-red-500 to-orange-500',
    bgColor: 'bg-red-500/20',
    textColor: 'text-red-400',
  },
  {
    id: 'conservative',
    aiModel: 'conservative model',
    name: 'Conservative',
    nameZh: 'ä¿å®ˆå‹',
    icon: 'ğŸ›¡ï¸',
    description: 'Low risk approach. Prefers draws and under goals.',
    color: 'from-blue-500 to-cyan-500',
    bgColor: 'bg-blue-500/20',
    textColor: 'text-blue-400',
  },
  {
    id: 'balanced',
    aiModel: 'balanced model',
    name: 'Balanced',
    nameZh: 'å¹³è¡¡å‹',
    icon: 'âš–ï¸',
    description: 'Moderate risk with balanced predictions.',
    color: 'from-emerald-500 to-cyan-500',
    bgColor: 'bg-emerald-500/20',
    textColor: 'text-emerald-400',
  },
  {
    id: 'value',
    aiModel: 'value model',
    name: 'Value Hunter',
    nameZh: 'ä»·å€¼å‹',
    icon: 'ğŸ’',
    description: 'Seeks undervalued odds and value bets.',
    color: 'from-purple-500 to-pink-500',
    bgColor: 'bg-purple-500/20',
    textColor: 'text-purple-400',
  },
  {
    id: 'safe',
    aiModel: 'safe model',
    name: 'Safe Play',
    nameZh: 'ç¨³å¥å‹',
    icon: 'ğŸ¦',
    description: 'Very safe picks with high confidence.',
    color: 'from-yellow-500 to-amber-500',
    bgColor: 'bg-yellow-500/20',
    textColor: 'text-yellow-400',
  },
];

// Flash animation types
type FlashType = 'up' | 'down' | 'none';

interface OddsFlash {
  moneyline_1x2_home: FlashType;
  moneyline_1x2_draw: FlashType;
  moneyline_1x2_away: FlashType;
  totalpoints_over: FlashType;
  totalpoints_under: FlashType;
  handicap_home: FlashType;
  handicap_away: FlashType;
}

// AI Predictions state interface
interface AIPredictions {
  moneyline: Moneyline1x2Prediction | null;
  overunder: OverUnderPrediction | null;
  handicap: HandicapPrediction | null;
  loading: boolean;
}

export default function MatchDetailsPage() {
  const params = useParams();
  const searchParams = useSearchParams();
  const router = useRouter();
  const dateParam = searchParams.get('date');
  const [match, setMatch] = useState<Prematch | null>(null);
  const [loading, setLoading] = useState(true);
  const [selectedPersonality, setSelectedPersonality] = useState('aggressive');
  const [selectedLang, setSelectedLang] = useState('EN');
  const [langDropdownOpen, setLangDropdownOpen] = useState(false);
  const [user, setUser] = useState<User | null>(null);
  const [authChecked, setAuthChecked] = useState(false);
  const [userSubscription, setUserSubscription] = useState<UserSubscription | null>(null);
  const currentLang = LANGUAGES.find(l => l.code === selectedLang) || LANGUAGES[0];

  // Check auth session and redirect if not logged in
  useEffect(() => {
    const checkUser = async () => {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session?.user) {
        // Not logged in - redirect to login
        router.push('/login');
        return;
      }
      setUser(session.user);
      setAuthChecked(true);
    };
    checkUser();

    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event: any, session: any) => {
      if (!session?.user) {
        router.push('/login');
        return;
      }
      setUser(session.user);
    });

    return () => subscription.unsubscribe();
  }, [router]);

  // Load user subscription
  useEffect(() => {
    const loadSubscription = async () => {
      if (user) {
        const { data } = await getUserSubscription(user.id);
        setUserSubscription(data);
      }
    };
    loadSubscription();
  }, [user]);

  // Check if a betting style is available based on subscription
  const isStyleAvailable = (styleId: string) => {
    // Aggressive is always available
    if (styleId === 'aggressive') return true;

    // If no subscription or free trial, only aggressive is available
    if (!userSubscription || userSubscription.package_type === 'free_trial') {
      return false;
    }

    // Starter and Pro plans: only 1 betting style (aggressive)
    if (userSubscription.package_type === 'starter' || userSubscription.package_type === 'pro') {
      return false;
    }

    // Ultimate plan: all styles available
    if (userSubscription.package_type === 'ultimate') {
      return true;
    }

    return false;
  };

  // Load language from localStorage on mount
  useEffect(() => {
    const savedLang = localStorage.getItem('oddsflow_lang');
    if (savedLang) {
      setSelectedLang(savedLang);
    }
  }, []);

  // Save language to localStorage when changed
  const handleLanguageChange = (langCode: string) => {
    setSelectedLang(langCode);
    localStorage.setItem('oddsflow_lang', langCode);
    setLangDropdownOpen(false);
  };

  // AI Predictions state
  const [aiPredictions, setAiPredictions] = useState<AIPredictions>({
    moneyline: null,
    overunder: null,
    handicap: null,
    loading: true,
  });

  // Match Prediction (from predictions_match table)
  const [matchPrediction, setMatchPrediction] = useState<MatchPrediction | null>(null);

  // Live Signals state (Value Hunter)
  const [liveSignals, setLiveSignals] = useState<LiveSignals | null>(null);
  const [liveSignalsLoading, setLiveSignalsLoading] = useState(false);

  // Lineup data
  const [lineups, setLineups] = useState<TeamLineup[] | null>(null);

  // Events data
  const [events, setEvents] = useState<FixtureEvent[] | null>(null);

  // Section tab filter: 'odds' | 'comparison' | 'lineups' | 'events'
  const [selectedSection, setSelectedSection] = useState<'odds' | 'comparison' | 'lineups' | 'events'>('odds');

  // Translation function
  const t = (key: string): string => {
    return translations[selectedLang]?.[key] || translations['EN']?.[key] || key;
  };

  // Odds related state
  const [currentOdds, setCurrentOdds] = useState<OddsHistory | null>(null);
  const [oddsHistory, setOddsHistory] = useState<OddsHistory[]>([]);
  const [showHistoryModal, setShowHistoryModal] = useState(false);
  const [refreshCountdown, setRefreshCountdown] = useState(10);
  const [oddsFlash, setOddsFlash] = useState<OddsFlash>({
    moneyline_1x2_home: 'none',
    moneyline_1x2_draw: 'none',
    moneyline_1x2_away: 'none',
    totalpoints_over: 'none',
    totalpoints_under: 'none',
    handicap_home: 'none',
    handicap_away: 'none',
  });
  const previousOddsRef = useRef<OddsHistory | null>(null);

  // Signal History state
  const [showSignalHistory, setShowSignalHistory] = useState<'moneyline' | 'overunder' | 'handicap' | 'value' | null>(null);
  const [signalHistory, setSignalHistory] = useState<{
    moneyline: Moneyline1x2Prediction[];
    overunder: OverUnderPrediction[];
    handicap: HandicapPrediction[];
  }>({ moneyline: [], overunder: [], handicap: [] });
  const [liveSignalsHistory, setLiveSignalsHistory] = useState<LiveSignals[]>([]);

  // Market type filter
  const [selectedMarket, setSelectedMarket] = useState<'moneyline' | 'overunder' | 'handicap'>('moneyline');

  // Profit Summary state
  const [profitSummary, setProfitSummary] = useState<ProfitSummary | null>(null);
  const [showProfitModal, setShowProfitModal] = useState(false);

  const currentPersonality = PERSONALITIES.find(p => p.id === selectedPersonality) || PERSONALITIES[0];

  // Fetch AI predictions from database
  const fetchAIPredictions = useCallback(async (fixtureId: number, aiModel: string) => {
    setAiPredictions(prev => ({ ...prev, loading: true }));

    try {
      // Fetch latest record from all 3 tables in parallel
      const [moneylineRes, ouRes, handicapRes] = await Promise.all([
        supabase
          .from('moneyline 1x2')
          .select('*')
          .eq('fixture_id', fixtureId)
          .eq('ai_model', aiModel)
          .order('created_at', { ascending: false })
          .limit(1),
        supabase
          .from('OverUnder')
          .select('*')
          .eq('fixture_id', fixtureId)
          .eq('ai_model', aiModel)
          .order('created_at', { ascending: false })
          .limit(1),
        supabase
          .from('Handicap')
          .select('*')
          .eq('fixture_id', fixtureId)
          .eq('ai_model', aiModel)
          .order('created_at', { ascending: false })
          .limit(1),
      ]);

      setAiPredictions({
        moneyline: moneylineRes.data?.[0] || null,
        overunder: ouRes.data?.[0] || null,
        handicap: handicapRes.data?.[0] || null,
        loading: false,
      });
    } catch (error) {
      console.error('Error fetching AI predictions:', error);
      setAiPredictions(prev => ({ ...prev, loading: false }));
    }
  }, []);

  // Update predictions when personality changes
  const handlePersonalityChange = (personalityId: string) => {
    setSelectedPersonality(personalityId);
  };

  // Fetch signal history for a specific market type
  const fetchSignalHistory = useCallback(async (type: 'moneyline' | 'overunder' | 'handicap') => {
    if (!match?.fixture_id) return;

    const personality = PERSONALITIES.find(p => p.id === selectedPersonality);
    if (!personality) return;

    try {
      let tableName = '';
      if (type === 'moneyline') tableName = 'moneyline 1x2';
      else if (type === 'overunder') tableName = 'OverUnder';
      else if (type === 'handicap') tableName = 'Handicap';

      const { data, error } = await supabase
        .from(tableName)
        .select('*')
        .eq('fixture_id', match.fixture_id)
        .eq('ai_model', personality.aiModel)
        .order('created_at', { ascending: false });

      if (!error && data) {
        setSignalHistory(prev => ({
          ...prev,
          [type]: data,
        }));
      }
    } catch (error) {
      console.error('Error fetching signal history:', error);
    }
  }, [match?.fixture_id, selectedPersonality]);

  // Fetch Value Hunter signal history
  const fetchValueHunterHistory = useCallback(async () => {
    if (!match?.fixture_id) return;
    try {
      const { data, error } = await supabase
        .from('live_signals_v7')
        .select('*')
        .eq('fixture_id', match.fixture_id)
        .order('created_at', { ascending: false });

      if (!error && data) {
        console.log('[Signal History] Raw data from Supabase:', data[0]);
        const parsed = data.map((d: unknown) => parseLiveSignals(d as LiveSignals) as LiveSignals).filter(Boolean);
        console.log('[Signal History] Parsed data:', parsed[0]);
        setLiveSignalsHistory(parsed);
      }
    } catch (error) {
      console.error('Error fetching value hunter history:', error);
    }
  }, [match?.fixture_id]);

  // Open signal history modal
  const openSignalHistory = (type: 'moneyline' | 'overunder' | 'handicap' | 'value') => {
    if (type === 'value') {
      fetchValueHunterHistory();
    } else {
      fetchSignalHistory(type);
    }
    setShowSignalHistory(type);
  };

  // Fetch profit summary for finished matches
  const fetchProfitSummary = useCallback(async (fixtureId: number) => {
    try {
      // fixture_id in profit_summary table is stored as string
      const { data, error } = await supabase
        .from('profit_summary')
        .select('*')
        .eq('fixture_id', String(fixtureId))
        .order('created_at', { ascending: false })
        .limit(1);

      if (!error && data && data.length > 0) {
        setProfitSummary(data[0]);
      } else {
        setProfitSummary(null);
      }
    } catch (error) {
      console.error('Error fetching profit summary:', error);
      setProfitSummary(null);
    }
  }, []);

  // Open profit summary modal
  const openProfitSummary = () => {
    if (match?.fixture_id) {
      fetchProfitSummary(match.fixture_id);
      setShowProfitModal(true);
    }
  };

  // Fetch AI predictions when personality or match changes
  useEffect(() => {
    const personality = PERSONALITIES.find(p => p.id === selectedPersonality);
    if (match?.fixture_id && personality) {
      fetchAIPredictions(match.fixture_id, personality.aiModel);

      // Fetch live signals for Value Hunter personality
      if (selectedPersonality === 'value') {
        setLiveSignalsLoading(true);
        getLiveSignals(match.fixture_id).then(({ data, error }) => {
          console.log('[Value Hunter] Response:', { data, error });
          setLiveSignals(parseLiveSignals(data));
          setLiveSignalsLoading(false);
        }).catch((err) => {
          console.error('[Value Hunter] Error:', err);
          setLiveSignalsLoading(false);
        });
      }
    }
  }, [selectedPersonality, match?.fixture_id, fetchAIPredictions]);

  // Fetch match data from database
  const fetchMatch = useCallback(async (isRefresh: boolean = false) => {
    try {
      const { data, error } = await supabase
        .from('prematches')
        .select('*')
        .eq('id', params.id)
        .single();

      if (error) throw error;
      setMatch(data);
      return data;
    } catch (error) {
      console.error('Error fetching match:', error);
      return null;
    } finally {
      if (!isRefresh) {
        setLoading(false);
      }
    }
  }, [params.id]);

  // Fetch odds from database
  const fetchOdds = useCallback(async (fixtureId: number, isLive: boolean) => {
    try {
      const { data, error } = await supabase
        .from('odds_history')
        .select('*')
        .eq('fixture_id', fixtureId)
        .order('created_at', { ascending: false });

      if (error) throw error;

      if (data && data.length > 0) {
        const latestOdds = data[0];

        // For live matches, calculate flash animations
        if (isLive && previousOddsRef.current) {
          const prev = previousOddsRef.current;
          const calcFlash = (newVal: number | null | undefined, oldVal: number | null | undefined): FlashType => {
            if (newVal == null || oldVal == null) return 'none';
            if (newVal < oldVal) return 'down';
            if (newVal > oldVal) return 'up';
            return 'none';
          };
          const newFlash: OddsFlash = {
            moneyline_1x2_home: calcFlash(latestOdds.moneyline_1x2_home, prev.moneyline_1x2_home),
            moneyline_1x2_draw: calcFlash(latestOdds.moneyline_1x2_draw, prev.moneyline_1x2_draw),
            moneyline_1x2_away: calcFlash(latestOdds.moneyline_1x2_away, prev.moneyline_1x2_away),
            totalpoints_over: calcFlash(latestOdds.totalpoints_over, prev.totalpoints_over),
            totalpoints_under: calcFlash(latestOdds.totalpoints_under, prev.totalpoints_under),
            handicap_home: calcFlash(latestOdds.handicap_home, prev.handicap_home),
            handicap_away: calcFlash(latestOdds.handicap_away, prev.handicap_away),
          };
          setOddsFlash(newFlash);

          // Clear flash after 2 seconds (match CSS animation duration)
          setTimeout(() => {
            setOddsFlash({
              moneyline_1x2_home: 'none',
              moneyline_1x2_draw: 'none',
              moneyline_1x2_away: 'none',
              totalpoints_over: 'none',
              totalpoints_under: 'none',
              handicap_home: 'none',
              handicap_away: 'none',
            });
          }, 2000);
        }

        previousOddsRef.current = latestOdds;
        setCurrentOdds(latestOdds);
        setOddsHistory(data);
      }
    } catch (error) {
      console.error('Error fetching odds:', error);
    }
  }, []);

  // Fetch all data (match + odds + AI predictions + lineups)
  const fetchAllData = useCallback(async (isRefresh: boolean = false) => {
    const matchData = await fetchMatch(isRefresh);
    console.log('[fetchAllData] matchData:', matchData?.id, 'fixture_id:', matchData?.fixture_id);
    if (matchData?.fixture_id) {
      // Fetch odds, AI predictions, match prediction, lineups, and events in parallel
      const personality = PERSONALITIES.find(p => p.id === selectedPersonality);
      const [, , predictionResult, lineupsResult, eventsResult] = await Promise.all([
        fetchOdds(matchData.fixture_id, matchData.type === 'In Play'),
        personality ? fetchAIPredictions(matchData.fixture_id, personality.aiModel) : Promise.resolve(),
        getMatchPrediction(matchData.fixture_id),
        // Only fetch lineups on initial load, not on refresh
        !isRefresh ? getFixtureLineups(matchData.fixture_id) : Promise.resolve({ data: null }),
        // Fetch events (always fetch to show live updates)
        getFixtureEvents(matchData.fixture_id),
      ]);
      if (predictionResult?.data) {
        setMatchPrediction(predictionResult.data);
      }
      if (lineupsResult?.data) {
        setLineups(lineupsResult.data);
      }
      if (eventsResult?.data) {
        console.log('[page] Setting events:', eventsResult.data.length, eventsResult.data);
        setEvents(eventsResult.data);
      } else {
        console.log('[page] No events data, eventsResult:', eventsResult);
      }
    }
  }, [fetchMatch, fetchOdds, fetchAIPredictions, selectedPersonality]);

  // Initial data fetch
  useEffect(() => {
    if (params.id) {
      fetchAllData(false);
    }
  }, [params.id, fetchAllData]);

  // Set up polling and countdown - refresh all data every 10 seconds
  useEffect(() => {
    if (match) {
      // Reset countdown
      setRefreshCountdown(10);

      // Countdown timer - updates every second and triggers fetch at 0
      const countdownInterval = setInterval(() => {
        setRefreshCountdown(prev => {
          if (prev <= 1) {
            // Fetch all data (match score + odds + AI predictions) when countdown reaches 0
            fetchAllData(true);
            return 10; // Reset to 10
          }
          return prev - 1;
        });
      }, 1000);

      return () => {
        clearInterval(countdownInterval);
      };
    }
  }, [match, fetchAllData]);

  // Background refresh for match score and clock every 10 seconds (for live matches)
  useEffect(() => {
    if (match?.type === 'In Play') {
      const scoreRefreshInterval = setInterval(() => {
        // Silently refresh match data (score + clock)
        fetchMatch(true);
      }, 10000); // Every 10 seconds

      return () => {
        clearInterval(scoreRefreshInterval);
      };
    }
  }, [match?.type, fetchMatch]);

  const formatDateTime = (dateStr: string) => {
    const date = new Date(dateStr);
    const day = date.getUTCDate();
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const month = months[date.getUTCMonth()];
    const hours = String(date.getUTCHours()).padStart(2, '0');
    const minutes = String(date.getUTCMinutes()).padStart(2, '0');
    return `${day} ${month} ${date.getUTCFullYear()} â€¢ ${hours}:${minutes} UTC`;
  };

  const formatHistoryTime = (dateStr: string) => {
    const date = new Date(dateStr);
    const day = date.getUTCDate();
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const month = months[date.getUTCMonth()];
    const hours = String(date.getUTCHours()).padStart(2, '0');
    const minutes = String(date.getUTCMinutes()).padStart(2, '0');
    return `${day} ${month} ${hours}:${minutes}`;
  };

  // Get flash animation class - RED for down (è·Œ), GREEN for up (æ¶¨)
  const getFlashClass = (flashType: FlashType) => {
    switch (flashType) {
      case 'down':
        return 'animate-flash-red';
      case 'up':
        return 'animate-flash-green';
      case 'none':
        return '';
      default:
        return '';
    }
  };

  // Render odds title based on match type
  const getOddsTitle = () => {
    switch (match?.type) {
      case 'Scheduled':
        return t('preMatchOdds');
      case 'In Play':
        return t('liveOdds');
      case 'Finished':
        return t('finalOdds');
      default:
        return t('odds');
    }
  };

  // Show loading while checking auth
  if (!authChecked) {
    return (
      <div className="min-h-screen bg-[#0a0a0f] text-white flex items-center justify-center">
        <div className="w-10 h-10 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin" />
      </div>
    );
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-[#0a0a0f] text-white flex items-center justify-center">
        <div className="w-10 h-10 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin" />
      </div>
    );
  }

  if (!match) {
    return (
      <div className="min-h-screen bg-[#0a0a0f] text-white flex flex-col items-center justify-center">
        <h1 className="text-2xl font-bold mb-4">Match not found</h1>
        <Link href={dateParam ? `/predictions?date=${dateParam}` : '/predictions'} className="text-emerald-400 hover:underline">
          â† {t('backToPredictions')}
        </Link>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-[#0a0a0f] text-white">
      {/* Navbar */}
      <nav className="fixed top-0 left-0 right-0 z-50 bg-black/20 backdrop-blur-xl border-b border-white/5">
        <div className="w-full px-4 sm:px-6 lg:px-12">
          <div className="flex items-center justify-between h-16">
            <Link href="/" className="flex items-center gap-3 flex-shrink-0">
              <img src="/homepage/OddsFlow Logo2.png" alt="OddsFlow Logo" className="w-14 h-14 object-contain" />
              <span className="text-xl font-bold tracking-tight">OddsFlow</span>
            </Link>

            <div className="hidden md:flex items-center gap-6">
              <Link href="/" className="text-gray-400 hover:text-white transition-colors text-sm font-medium">{t('home')}</Link>
              <Link href="/predictions" className="text-emerald-400 text-sm font-medium">{t('predictions')}</Link>
              <Link href="/leagues" className="text-gray-400 hover:text-white transition-colors text-sm font-medium">{t('leagues')}</Link>
              <Link href="/performance" className="text-gray-400 hover:text-white transition-colors text-sm font-medium">{t('performance')}</Link>
              <Link href="/community" className="text-gray-400 hover:text-white transition-colors text-sm font-medium">{t('community')}</Link>
              <Link href="/news" className="text-gray-400 hover:text-white transition-colors text-sm font-medium">{t('news')}</Link>
              <Link href="/solution" className="text-gray-400 hover:text-white transition-colors text-sm font-medium">{t('solution')}</Link>
              <Link href="/pricing" className="text-gray-400 hover:text-white transition-colors text-sm font-medium">{t('pricing')}</Link>
            </div>

            <div className="flex items-center gap-2 sm:gap-3 flex-shrink-0">
              {/* Language Selector */}
              <div className="relative">
                <button
                  onClick={() => setLangDropdownOpen(!langDropdownOpen)}
                  className="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all text-sm cursor-pointer"
                >
                  <FlagIcon code={currentLang.code} size={20} />
                  <span className="font-medium">{currentLang.code}</span>
                  <svg
                    className={`w-4 h-4 transition-transform ${langDropdownOpen ? 'rotate-180' : ''}`}
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                  </svg>
                </button>

                {langDropdownOpen && (
                  <>
                    <div className="fixed inset-0 z-40" onClick={() => setLangDropdownOpen(false)} />
                    <div className="absolute right-0 mt-2 w-48 py-2 bg-gray-900 border border-white/10 rounded-xl shadow-xl z-50 max-h-80 overflow-y-auto">
                      {LANGUAGES.map((l) => (
                        <button
                          key={l.code}
                          onClick={() => handleLanguageChange(l.code)}
                          className={`w-full flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors text-left cursor-pointer ${
                            selectedLang === l.code ? 'bg-emerald-500/20 text-emerald-400' : 'text-gray-300'
                          }`}
                        >
                          <FlagIcon code={l.code} size={20} />
                          <span className="font-medium">{l.name}</span>
                        </button>
                      ))}
                    </div>
                  </>
                )}
              </div>
              {user ? (
                <Link href="/dashboard" className="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all cursor-pointer">
                  {user.user_metadata?.avatar_url || user.user_metadata?.picture ? (
                    <img src={user.user_metadata?.avatar_url || user.user_metadata?.picture} alt="" className="w-8 h-8 rounded-full" />
                  ) : (
                    <div className="w-8 h-8 rounded-full bg-gradient-to-r from-emerald-500 to-cyan-500 flex items-center justify-center text-black font-bold text-sm">
                      {user.user_metadata?.full_name?.charAt(0) || user.email?.charAt(0)?.toUpperCase() || 'U'}
                    </div>
                  )}
                  <span className="text-sm font-medium hidden sm:block">{user.user_metadata?.full_name || user.email?.split('@')[0]}</span>
                </Link>
              ) : (
                <>
                  <Link href="/login" className="px-4 py-2 rounded-lg border border-white/20 text-white hover:bg-white/10 transition-all text-sm font-medium hidden sm:block cursor-pointer">{t('login')}</Link>
                  <Link href="/get-started" className="px-5 py-2.5 rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-500 text-black font-semibold text-sm hover:shadow-lg hover:shadow-emerald-500/25 transition-all cursor-pointer">{t('getStarted')}</Link>
                </>
              )}

              {/* World Cup Special Button */}
              <Link
                href="/worldcup"
                className="relative hidden sm:flex items-center gap-1.5 px-5 py-2.5 rounded-lg bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-400 shadow-[0_0_20px_rgba(251,191,36,0.5)] hover:shadow-[0_0_30px_rgba(251,191,36,0.7)] transition-all cursor-pointer group overflow-hidden hover:scale-105"
              >
                <span className="absolute inset-0 bg-gradient-to-r from-transparent via-white/60 to-transparent animate-shimmer" />
                <img src="/homepage/FIFA-2026-World-Cup-Logo-removebg-preview.png" alt="FIFA World Cup 2026" className="h-5 w-auto object-contain relative z-10" />
                <span className="text-black font-semibold text-sm relative z-10">FIFA 2026</span>
              </Link>
            </div>
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <main className="pt-24 pb-16 px-4">
        <div className="max-w-4xl mx-auto">
          {/* Back Button */}
          <Link href={dateParam ? `/predictions?date=${dateParam}` : '/predictions'} className="inline-flex items-center gap-2 text-gray-400 hover:text-white transition-colors mb-6">
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
            {t('backToPredictions')}
          </Link>

          {/* Match Header */}
          <div className="relative rounded-2xl border border-white/5 p-6 mb-6 overflow-hidden">
            {/* Background Image */}
            <img
              src="/loading/2425_MD33_FCBBMG_JH_093_4gud8JWh_20250512053606.webp"
              alt=""
              className="absolute inset-0 w-full h-full object-cover"
            />
            {/* Dark Overlay */}
            <div className="absolute inset-0 bg-gradient-to-br from-gray-900/90 to-gray-950/95" />

            {/* League */}
            <div className="relative flex items-center gap-3 mb-6">
              {match.league_logo && (
                <div className="w-8 h-8 rounded-lg bg-white p-1 flex items-center justify-center">
                  <img src={match.league_logo} alt={match.league_name} className="w-6 h-6 object-contain" />
                </div>
              )}
              <span className="text-gray-400 font-medium">{match.league_name}</span>
              <span className="text-gray-600">â€¢</span>
              <span className="text-gray-500 text-sm">{formatDateTime(match.start_date_msia)}</span>
            </div>

            {/* Teams */}
            <div className="relative flex items-center justify-center gap-8 py-6">
              {/* Home Team */}
              <div className="flex flex-col items-center gap-3 flex-1">
                <div className="relative">
                  {match.home_logo && (
                    <div className={`w-20 h-20 rounded-full bg-white p-2 flex items-center justify-center shadow-lg ${
                      match.type === 'Finished' && (match.goals_home ?? 0) > (match.goals_away ?? 0) ? 'ring-2 ring-emerald-500' : ''
                    }`}>
                      <img src={match.home_logo} alt={match.home_name} className="w-full h-full object-contain" />
                    </div>
                  )}
                  {match.type === 'Finished' && (match.goals_home ?? 0) > (match.goals_away ?? 0) && (
                    <div className="absolute -top-1 -right-1 px-2 py-0.5 rounded-full bg-emerald-500 text-white text-[10px] font-bold shadow-lg">
                      WIN
                    </div>
                  )}
                </div>
                <span className={`font-semibold text-lg text-center ${
                  match.type === 'Finished' && (match.goals_home ?? 0) > (match.goals_away ?? 0) ? 'text-emerald-400' : 'text-white'
                }`}>{match.home_name}</span>
                <span className="text-xs text-gray-500">HOME</span>
              </div>

              {/* VS / Score */}
              <div className="flex flex-col items-center">
                {(match.type === 'In Play' || match.type === 'Finished') ? (
                  <>
                    <div className="flex items-center gap-4">
                      <span className={`text-4xl font-bold ${match.type === 'In Play' ? 'text-white' : 'text-gray-300'}`}>
                        {match.goals_home ?? 0}
                      </span>
                      <span className="text-2xl font-bold text-gray-600">-</span>
                      <span className={`text-4xl font-bold ${match.type === 'In Play' ? 'text-white' : 'text-gray-300'}`}>
                        {match.goals_away ?? 0}
                      </span>
                    </div>
                    <span className={`mt-2 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1.5 ${
                      match.type === 'In Play' ? 'bg-red-500/20 text-red-400' : 'bg-gray-500/20 text-gray-400'
                    }`}>
                      {match.type === 'In Play' && (
                        <span className="w-2 h-2 rounded-full bg-red-500 animate-pulse" />
                      )}
                      {match.type === 'In Play' ? (match.status_elapsed ? `${match.status_elapsed}'` : 'LIVE') : 'Full Time'}
                    </span>
                  </>
                ) : (
                  <>
                    <span className="text-3xl font-bold text-gray-600">VS</span>
                    <span className={`mt-2 px-3 py-1 rounded-full text-xs font-medium ${
                      match.type === 'Postponed' ? 'bg-amber-500/20 text-amber-400' :
                      match.type === 'Cancelled' ? 'bg-red-500/20 text-red-400' :
                      match.type === 'Abandoned' ? 'bg-orange-500/20 text-orange-400' :
                      match.type === 'Not Played' ? 'bg-gray-500/20 text-gray-400' :
                      'bg-emerald-500/20 text-emerald-400'
                    }`}>
                      {match.type === 'Postponed' ? 'Postponed' :
                       match.type === 'Cancelled' ? 'Cancelled' :
                       match.type === 'Abandoned' ? 'Abandoned' :
                       match.type === 'Not Played' ? 'Not Played' :
                       'Not Started'}
                    </span>
                  </>
                )}
              </div>

              {/* Away Team */}
              <div className="flex flex-col items-center gap-3 flex-1">
                <div className="relative">
                  {match.away_logo && (
                    <div className={`w-20 h-20 rounded-full bg-white p-2 flex items-center justify-center shadow-lg ${
                      match.type === 'Finished' && (match.goals_away ?? 0) > (match.goals_home ?? 0) ? 'ring-2 ring-emerald-500' : ''
                    }`}>
                      <img src={match.away_logo} alt={match.away_name} className="w-full h-full object-contain" />
                    </div>
                  )}
                  {match.type === 'Finished' && (match.goals_away ?? 0) > (match.goals_home ?? 0) && (
                    <div className="absolute -top-1 -right-1 px-2 py-0.5 rounded-full bg-emerald-500 text-white text-[10px] font-bold shadow-lg">
                      WIN
                    </div>
                  )}
                </div>
                <span className={`font-semibold text-lg text-center ${
                  match.type === 'Finished' && (match.goals_away ?? 0) > (match.goals_home ?? 0) ? 'text-emerald-400' : 'text-white'
                }`}>{match.away_name}</span>
                <span className="text-xs text-gray-500">AWAY</span>
              </div>
            </div>

            {/* Venue */}
            {match.venue_name && (
              <div className="relative text-center text-gray-500 text-sm mt-4">
                <svg className="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                {match.venue_name}, {match.venue_city}
              </div>
            )}
          </div>

          {/* Section Tab Filter */}
          <div className="flex items-center gap-2 mb-6 overflow-x-auto pb-2">
            <button
              onClick={() => setSelectedSection('odds')}
              className={`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${
                selectedSection === 'odds'
                  ? 'bg-gradient-to-r from-emerald-500 to-cyan-500 text-white shadow-lg shadow-emerald-500/25'
                  : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white border border-white/10'
              }`}
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
              </svg>
              {t('tabOdds')}
            </button>
            <button
              onClick={() => setSelectedSection('comparison')}
              className={`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${
                selectedSection === 'comparison'
                  ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg shadow-purple-500/25'
                  : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white border border-white/10'
              }`}
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              {t('tabComparison')}
            </button>
            <button
              onClick={() => setSelectedSection('lineups')}
              className={`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${
                selectedSection === 'lineups'
                  ? 'bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg shadow-green-500/25'
                  : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white border border-white/10'
              }`}
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              {t('tabLineups')}
            </button>
            <button
              onClick={() => setSelectedSection('events')}
              className={`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${
                selectedSection === 'events'
                  ? 'bg-gradient-to-r from-orange-500 to-amber-600 text-white shadow-lg shadow-orange-500/25'
                  : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white border border-white/10'
              }`}
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              {t('tabEvents')}
              {match.type === 'In Play' && (
                <div className="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse" />
              )}
            </button>
          </div>

          {/* Team Comparison Section - AI Analysis */}
          {selectedSection === 'comparison' && (
          <div className="bg-gradient-to-br from-gray-900/80 to-gray-950/80 rounded-2xl border border-white/5 p-4 sm:p-5 mb-6">
            {/* Header */}
            <div className="flex items-center gap-3 mb-6">
              <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
              </div>
              <div>
                <h2 className="text-lg font-bold text-white">{t('teamComparison')}</h2>
                <p className="text-xs text-gray-500">{t('aiAnalysis')}</p>
              </div>
            </div>

            {/* Content */}
            <div>
              {!matchPrediction || (!matchPrediction.winner_name && !matchPrediction.prob_home && !matchPrediction.strength_home) ? (
                  <div className="text-center py-12">
                    <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-purple-500/10 border border-purple-500/20 flex items-center justify-center">
                      <svg className="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                      </svg>
                    </div>
                    <h3 className="text-lg font-semibold text-gray-300 mb-2">Team Comparison Coming Soon</h3>
                    <p className="text-gray-500 text-sm">AI analysis data will be available closer to match time</p>
                  </div>
                ) : (
                  <>
                  {/* AI Advice */}
                  {matchPrediction.advice && (
                    <div className="mb-6 p-4 rounded-xl bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border border-emerald-500/20">
                      <div className="flex items-start gap-3">
                        <div className="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                          <svg className="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                          </svg>
                        </div>
                        <div>
                          <div className="text-xs text-emerald-400 font-medium uppercase tracking-wider mb-1">AI Advice</div>
                          <p className="text-gray-300 text-sm">{matchPrediction.advice}</p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Prediction Summary */}
                  <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                    {matchPrediction.winner_name && (
                      <div className="relative overflow-hidden rounded-xl p-4 text-center bg-gradient-to-br from-emerald-500/20 to-cyan-500/20 border border-emerald-500/30 shadow-lg shadow-emerald-500/20">
                        {/* Shimmer effect */}
                        <div className="absolute inset-0 animate-shimmer bg-gradient-to-r from-transparent via-white/25 to-transparent" />
                        {/* Glow pulse */}
                        <div className="absolute inset-0 animate-pulse bg-emerald-500/10 rounded-xl" />
                        <div className="relative">
                          <div className="text-xs text-emerald-300/80 mb-2 font-medium uppercase tracking-wider">Predicted Winner</div>
                          <div className="text-emerald-400 font-bold text-lg flex items-center justify-center gap-2">
                            <span className="animate-bounce text-xl">ğŸ†</span>
                            <span className="drop-shadow-[0_0_10px_rgba(16,185,129,0.5)]">{matchPrediction.winner_name}</span>
                          </div>
                        </div>
                      </div>
                    )}
                    {matchPrediction.under_over && (
                      <div className="bg-white/5 rounded-xl p-4 text-center border border-white/5">
                        <div className="text-xs text-gray-500 mb-2 uppercase tracking-wider">Goals</div>
                        <div className="text-cyan-400 font-bold text-base">{matchPrediction.under_over}</div>
                      </div>
                    )}
                    {matchPrediction.goals_home && (
                      <div className={`relative overflow-hidden rounded-xl p-4 text-center border transition-all duration-300 ${
                        matchPrediction.winner_name === match?.home_name
                          ? 'bg-gradient-to-br from-blue-500/20 to-cyan-500/20 border-blue-500/30 shadow-lg shadow-blue-500/20'
                          : 'bg-gradient-to-br from-blue-500/10 to-blue-600/5 border-blue-500/20'
                      }`}>
                        {/* Shimmer effect for winner or subtle pulse for non-winner */}
                        {matchPrediction.winner_name === match?.home_name ? (
                          <div className="absolute inset-0 animate-shimmer bg-gradient-to-r from-transparent via-white/20 to-transparent" />
                        ) : (
                          <div className="absolute inset-0 animate-pulse bg-blue-500/5 rounded-xl" />
                        )}
                        <div className="relative">
                          <div className={`text-xs mb-2 uppercase tracking-wider ${matchPrediction.winner_name === match?.home_name ? 'text-blue-300/80 font-medium' : 'text-gray-500'}`}>Home Goals</div>
                          <div className={`font-bold text-lg ${matchPrediction.winner_name === match?.home_name ? 'text-blue-400 drop-shadow-[0_0_10px_rgba(59,130,246,0.6)]' : 'text-blue-400'}`}>
                            {matchPrediction.goals_home}
                          </div>
                        </div>
                      </div>
                    )}
                    {matchPrediction.goals_away && (
                      <div className={`relative overflow-hidden rounded-xl p-4 text-center border transition-all duration-300 ${
                        matchPrediction.winner_name === match?.away_name
                          ? 'bg-gradient-to-br from-green-500/20 to-emerald-500/20 border-green-500/30 shadow-lg shadow-green-500/20'
                          : 'bg-gradient-to-br from-green-500/10 to-green-600/5 border-green-500/20'
                      }`}>
                        {/* Shimmer effect for winner or subtle pulse for non-winner */}
                        {matchPrediction.winner_name === match?.away_name ? (
                          <div className="absolute inset-0 animate-shimmer bg-gradient-to-r from-transparent via-white/20 to-transparent" />
                        ) : (
                          <div className="absolute inset-0 animate-pulse bg-green-500/5 rounded-xl" />
                        )}
                        <div className="relative">
                          <div className={`text-xs mb-2 uppercase tracking-wider ${matchPrediction.winner_name === match?.away_name ? 'text-green-300/80 font-medium' : 'text-gray-500'}`}>Away Goals</div>
                          <div className={`font-bold text-lg ${matchPrediction.winner_name === match?.away_name ? 'text-green-400 drop-shadow-[0_0_10px_rgba(34,197,94,0.6)]' : 'text-green-400'}`}>
                            {matchPrediction.goals_away}
                          </div>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Win Probability Bar */}
                  {(matchPrediction.prob_home || matchPrediction.prob_draw || matchPrediction.prob_away) && (
                    <div className="mb-6">
                      <div className="text-xs text-gray-500 mb-2 uppercase tracking-wider">Win Probability</div>
                      <div className="flex h-8 rounded-lg overflow-hidden">
                        <div
                          className="bg-blue-500 flex items-center justify-center text-xs font-bold text-white"
                          style={{ width: `${matchPrediction.prob_home || 0}%` }}
                        >
                          {matchPrediction.prob_home ? `${Math.round(matchPrediction.prob_home)}%` : ''}
                        </div>
                        <div
                          className="bg-gray-500 flex items-center justify-center text-xs font-bold text-white"
                          style={{ width: `${matchPrediction.prob_draw || 0}%` }}
                        >
                          {matchPrediction.prob_draw ? `${Math.round(matchPrediction.prob_draw)}%` : ''}
                        </div>
                        <div
                          className="bg-green-500 flex items-center justify-center text-xs font-bold text-white"
                          style={{ width: `${matchPrediction.prob_away || 0}%` }}
                        >
                          {matchPrediction.prob_away ? `${Math.round(matchPrediction.prob_away)}%` : ''}
                        </div>
                      </div>
                      <div className="flex justify-between text-xs text-gray-500 mt-1">
                        <span>{match?.home_name}</span>
                        <span>Draw</span>
                        <span>{match?.away_name}</span>
                      </div>
                    </div>
                  )}

                  {/* Radar Chart */}
                  <div className="mb-8">
                    <ResponsiveContainer width="100%" height={320}>
                      <RadarChart
                        data={[
                          { stat: 'Strength', home: matchPrediction.strength_home ?? 0, away: matchPrediction.strength_away ?? 0 },
                          { stat: 'Attacking', home: matchPrediction.attacking_home ?? 0, away: matchPrediction.attacking_away ?? 0 },
                          { stat: 'Defensive', home: matchPrediction.defensive_home ?? 0, away: matchPrediction.defensive_away ?? 0 },
                          { stat: 'Poisson', home: matchPrediction.poisson_home ?? 0, away: matchPrediction.poisson_away ?? 0 },
                          { stat: 'H2H Strength', home: matchPrediction.h2h_strength_home ?? 0, away: matchPrediction.h2h_strength_away ?? 0 },
                          { stat: 'H2H Goals', home: matchPrediction.h2h_goals_home ?? 0, away: matchPrediction.h2h_goals_away ?? 0 },
                        ]}
                        margin={{ top: 20, right: 30, bottom: 20, left: 30 }}
                      >
                        <PolarGrid stroke="#374151" />
                        <PolarAngleAxis
                          dataKey="stat"
                          tick={{ fill: '#9CA3AF', fontSize: 11 }}
                        />
                        <PolarRadiusAxis
                          angle={90}
                          domain={[0, 100]}
                          tick={{ fill: '#6B7280', fontSize: 10 }}
                          tickCount={6}
                        />
                        <Radar
                          name={match?.home_name || 'Home'}
                          dataKey="home"
                          stroke="#3B82F6"
                          fill="#3B82F6"
                          fillOpacity={0.4}
                          strokeWidth={2}
                        />
                        <Radar
                          name={match?.away_name || 'Away'}
                          dataKey="away"
                          stroke="#22C55E"
                          fill="#22C55E"
                          fillOpacity={0.4}
                          strokeWidth={2}
                        />
                        <Legend
                          wrapperStyle={{ paddingTop: '20px' }}
                          formatter={(value) => <span style={{ color: '#D1D5DB', fontSize: '12px' }}>{value}</span>}
                        />
                      </RadarChart>
                    </ResponsiveContainer>
                  </div>

                  {/* Comparison Bars */}
                  <div className="space-y-4">
                    {/* Strength */}
                    {(matchPrediction.strength_home !== null || matchPrediction.strength_away !== null) && (
                      <div>
                        <div className="flex justify-between text-xs mb-1">
                          <span className="text-blue-400 font-medium">{matchPrediction.strength_home ?? 0}%</span>
                          <span className="text-gray-400 uppercase tracking-wider">Strength</span>
                          <span className="text-green-400 font-medium">{matchPrediction.strength_away ?? 0}%</span>
                        </div>
                        <div className="flex h-2 gap-1">
                          <div className="flex-1 bg-gray-700 rounded-l-full overflow-hidden">
                            <div className="h-full bg-blue-500 float-right" style={{ width: `${matchPrediction.strength_home ?? 0}%` }} />
                          </div>
                          <div className="flex-1 bg-gray-700 rounded-r-full overflow-hidden">
                            <div className="h-full bg-green-500" style={{ width: `${matchPrediction.strength_away ?? 0}%` }} />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Attacking Potential */}
                    {(matchPrediction.attacking_home !== null || matchPrediction.attacking_away !== null) && (
                      <div>
                        <div className="flex justify-between text-xs mb-1">
                          <span className="text-blue-400 font-medium">{matchPrediction.attacking_home ?? 0}%</span>
                          <span className="text-gray-400 uppercase tracking-wider">Attacking</span>
                          <span className="text-green-400 font-medium">{matchPrediction.attacking_away ?? 0}%</span>
                        </div>
                        <div className="flex h-2 gap-1">
                          <div className="flex-1 bg-gray-700 rounded-l-full overflow-hidden">
                            <div className="h-full bg-blue-500 float-right" style={{ width: `${matchPrediction.attacking_home ?? 0}%` }} />
                          </div>
                          <div className="flex-1 bg-gray-700 rounded-r-full overflow-hidden">
                            <div className="h-full bg-green-500" style={{ width: `${matchPrediction.attacking_away ?? 0}%` }} />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Defensive Potential */}
                    {(matchPrediction.defensive_home !== null || matchPrediction.defensive_away !== null) && (
                      <div>
                        <div className="flex justify-between text-xs mb-1">
                          <span className="text-blue-400 font-medium">{matchPrediction.defensive_home ?? 0}%</span>
                          <span className="text-gray-400 uppercase tracking-wider">Defensive</span>
                          <span className="text-green-400 font-medium">{matchPrediction.defensive_away ?? 0}%</span>
                        </div>
                        <div className="flex h-2 gap-1">
                          <div className="flex-1 bg-gray-700 rounded-l-full overflow-hidden">
                            <div className="h-full bg-blue-500 float-right" style={{ width: `${matchPrediction.defensive_home ?? 0}%` }} />
                          </div>
                          <div className="flex-1 bg-gray-700 rounded-r-full overflow-hidden">
                            <div className="h-full bg-green-500" style={{ width: `${matchPrediction.defensive_away ?? 0}%` }} />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Poisson Distribution */}
                    {(matchPrediction.poisson_home !== null || matchPrediction.poisson_away !== null) && (
                      <div>
                        <div className="flex justify-between text-xs mb-1">
                          <span className="text-blue-400 font-medium">{matchPrediction.poisson_home ?? 0}%</span>
                          <span className="text-gray-400 uppercase tracking-wider">Poisson</span>
                          <span className="text-green-400 font-medium">{matchPrediction.poisson_away ?? 0}%</span>
                        </div>
                        <div className="flex h-2 gap-1">
                          <div className="flex-1 bg-gray-700 rounded-l-full overflow-hidden">
                            <div className="h-full bg-blue-500 float-right" style={{ width: `${matchPrediction.poisson_home ?? 0}%` }} />
                          </div>
                          <div className="flex-1 bg-gray-700 rounded-r-full overflow-hidden">
                            <div className="h-full bg-green-500" style={{ width: `${matchPrediction.poisson_away ?? 0}%` }} />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* H2H Strength */}
                    {(matchPrediction.h2h_strength_home !== null || matchPrediction.h2h_strength_away !== null) && (
                      <div>
                        <div className="flex justify-between text-xs mb-1">
                          <span className="text-blue-400 font-medium">{matchPrediction.h2h_strength_home ?? 0}%</span>
                          <span className="text-gray-400 uppercase tracking-wider">H2H Strength</span>
                          <span className="text-green-400 font-medium">{matchPrediction.h2h_strength_away ?? 0}%</span>
                        </div>
                        <div className="flex h-2 gap-1">
                          <div className="flex-1 bg-gray-700 rounded-l-full overflow-hidden">
                            <div className="h-full bg-blue-500 float-right" style={{ width: `${matchPrediction.h2h_strength_home ?? 0}%` }} />
                          </div>
                          <div className="flex-1 bg-gray-700 rounded-r-full overflow-hidden">
                            <div className="h-full bg-green-500" style={{ width: `${matchPrediction.h2h_strength_away ?? 0}%` }} />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* H2H Goals */}
                    {(matchPrediction.h2h_goals_home !== null || matchPrediction.h2h_goals_away !== null) && (
                      <div>
                        <div className="flex justify-between text-xs mb-1">
                          <span className="text-blue-400 font-medium">{matchPrediction.h2h_goals_home ?? 0}%</span>
                          <span className="text-gray-400 uppercase tracking-wider">H2H Goals</span>
                          <span className="text-green-400 font-medium">{matchPrediction.h2h_goals_away ?? 0}%</span>
                        </div>
                        <div className="flex h-2 gap-1">
                          <div className="flex-1 bg-gray-700 rounded-l-full overflow-hidden">
                            <div className="h-full bg-blue-500 float-right" style={{ width: `${matchPrediction.h2h_goals_home ?? 0}%` }} />
                          </div>
                          <div className="flex-1 bg-gray-700 rounded-r-full overflow-hidden">
                            <div className="h-full bg-green-500" style={{ width: `${matchPrediction.h2h_goals_away ?? 0}%` }} />
                          </div>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Team Legend */}
                  <div className="flex justify-center gap-6 mt-4 pt-4 border-t border-white/5">
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                      <span className="text-xs text-gray-400">{match?.home_name}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 rounded-full bg-green-500"></div>
                      <span className="text-xs text-gray-400">{match?.away_name}</span>
                    </div>
                  </div>
                  </>
                )}
            </div>
          </div>
          )}

          {/* Team Lineups Section */}
          {selectedSection === 'lineups' && (
          <div className="bg-gradient-to-br from-gray-900/80 to-gray-950/80 rounded-2xl border border-white/5 p-4 sm:p-5 mb-6">
            {/* Header */}
            <div className="flex items-center gap-3 mb-6">
              <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center">
                <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
              </div>
              <div>
                <h2 className="text-lg font-bold text-white">{t('teamLineups')}</h2>
                <p className="text-xs text-gray-500">{t('startingXI')}</p>
              </div>
            </div>

            {/* Content */}
            <div>
              {/* No lineup data message */}
              {(!lineups || lineups.length === 0) ? (
                  <div className="flex flex-col items-center justify-center py-12 text-center">
                    <div className="w-16 h-16 rounded-full bg-gray-800/50 flex items-center justify-center mb-4">
                      <svg className="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                    </div>
                    <h3 className="text-white font-medium mb-2">{t('lineupNotAvailable')}</h3>
                    <p className="text-gray-500 text-sm max-w-md">
                      {t('lineupNotAvailableDesc')}
                    </p>
                  </div>
                ) : (
                  <>
                  {/* Football Pitch */}
                  <div className="relative w-full aspect-[2/1] bg-gradient-to-b from-green-700 to-green-800 rounded-xl overflow-hidden mb-6">
                    {/* Pitch markings */}
                    <div className="absolute inset-0">
                      {/* Center line */}
                      <div className="absolute left-1/2 top-0 bottom-0 w-0.5 bg-white/30" />
                      {/* Center circle */}
                      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-24 h-24 border-2 border-white/30 rounded-full" />
                      {/* Center dot */}
                      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-white/50 rounded-full" />
                      {/* Left penalty area */}
                      <div className="absolute left-0 top-1/2 -translate-y-1/2 w-[12%] h-[60%] border-2 border-l-0 border-white/30" />
                      {/* Left goal area */}
                      <div className="absolute left-0 top-1/2 -translate-y-1/2 w-[5%] h-[30%] border-2 border-l-0 border-white/30" />
                      {/* Right penalty area */}
                      <div className="absolute right-0 top-1/2 -translate-y-1/2 w-[12%] h-[60%] border-2 border-r-0 border-white/30" />
                      {/* Right goal area */}
                      <div className="absolute right-0 top-1/2 -translate-y-1/2 w-[5%] h-[30%] border-2 border-r-0 border-white/30" />
                    </div>

                    {/* Formation labels */}
                    <div className="absolute top-2 left-4 px-2 py-1 bg-black/50 rounded text-xs text-white font-medium">
                      {lineups[0]?.summary.formation || 'N/A'}
                    </div>
                    <div className="absolute top-2 right-4 px-2 py-1 bg-black/50 rounded text-xs text-white font-medium">
                      {lineups[1]?.summary.formation || 'N/A'}
                    </div>

                    {/* Home team players (left side) */}
                    {lineups[0]?.starters.map((player: FixturePlayer) => {
                      if (!player.grid) return null;
                      const [row, col] = player.grid.split(':').map(Number);
                      // Convert grid to percentage positions (home team on left)
                      const left = ((row - 1) / 4) * 45 + 5; // 5% to 50%
                      const playersInRow = lineups[0].starters.filter((p: FixturePlayer) => p.grid?.startsWith(row + ':'));
                      const verticalCount = playersInRow.length;
                      const topAdjusted = verticalCount === 1 ? 50 : ((col - 1) / Math.max(verticalCount - 1, 1)) * 70 + 15;

                      return (
                        <div
                          key={player.id}
                          className="absolute transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center"
                          style={{ left: `${left}%`, top: `${topAdjusted}%` }}
                        >
                          <div className="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-blue-500 border-2 border-white flex items-center justify-center text-white text-xs sm:text-sm font-bold shadow-lg">
                            {player.number || '?'}
                          </div>
                          <span className="mt-1 px-1 bg-black/60 rounded text-[8px] sm:text-[10px] text-white whitespace-nowrap max-w-[60px] truncate">
                            {player.player_name?.split(' ').pop() || player.player_name}
                          </span>
                        </div>
                      );
                    })}

                    {/* Away team players (right side) */}
                    {lineups[1]?.starters.map((player: FixturePlayer) => {
                      if (!player.grid) return null;
                      const [row, col] = player.grid.split(':').map(Number);
                      // Convert grid to percentage positions (away team on right, mirrored)
                      const left = 95 - ((row - 1) / 4) * 45; // 95% to 50%
                      const playersInRow = lineups[1].starters.filter((p: FixturePlayer) => p.grid?.startsWith(row + ':'));
                      const verticalCount = playersInRow.length;
                      const topAdjusted = verticalCount === 1 ? 50 : ((col - 1) / Math.max(verticalCount - 1, 1)) * 70 + 15;

                      return (
                        <div
                          key={player.id}
                          className="absolute transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center"
                          style={{ left: `${left}%`, top: `${topAdjusted}%` }}
                        >
                          <div className="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-green-500 border-2 border-white flex items-center justify-center text-white text-xs sm:text-sm font-bold shadow-lg">
                            {player.number || '?'}
                          </div>
                          <span className="mt-1 px-1 bg-black/60 rounded text-[8px] sm:text-[10px] text-white whitespace-nowrap max-w-[60px] truncate">
                            {player.player_name?.split(' ').pop() || player.player_name}
                          </span>
                        </div>
                      );
                    })}
                  </div>

                  {/* Team Lists */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {lineups.map((lineup: TeamLineup, index: number) => (
                      <div key={lineup.summary.team_id} className={`rounded-xl overflow-hidden ${index === 0 ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-green-500/10 border border-green-500/20'}`}>
                        {/* Team Header */}
                        <div className={`px-4 py-3 flex items-center justify-between ${index === 0 ? 'bg-blue-500/20' : 'bg-green-500/20'}`}>
                          <div className="flex items-center gap-3">
                            <div className={`w-1 h-8 rounded-full ${index === 0 ? 'bg-blue-500' : 'bg-green-500'}`} />
                            <div>
                              <h3 className="font-bold text-white">{lineup.summary.team_name}</h3>
                              <span className="text-xs text-gray-400">{lineup.summary.formation || 'N/A'}</span>
                            </div>
                          </div>
                          {match && (
                            <img
                              src={index === 0 ? match.home_logo : match.away_logo}
                              alt={lineup.summary.team_name}
                              className="w-10 h-10 object-contain"
                            />
                          )}
                        </div>

                        {/* Coach */}
                        {lineup.summary.coach_name && (
                          <div className="px-4 py-2 border-b border-white/5">
                            <div className="text-xs text-gray-500 uppercase tracking-wider">Coach</div>
                            <div className="text-sm text-white">{lineup.summary.coach_name}</div>
                          </div>
                        )}

                        {/* Starting XI */}
                        <div className="px-4 py-2">
                          <div className="text-xs text-gray-500 uppercase tracking-wider mb-2">Starting XI</div>
                          <div className="space-y-1">
                            {lineup.starters.map((player: FixturePlayer) => (
                              <div key={player.id} className="flex items-center gap-2 text-sm">
                                <span className={`w-6 text-center font-mono ${index === 0 ? 'text-blue-400' : 'text-green-400'}`}>
                                  {player.number || '-'}
                                </span>
                                <span className="text-white">{player.player_name}</span>
                                <span className="text-gray-500 text-xs ml-auto">{player.pos}</span>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* Substitutes */}
                        {lineup.substitutes.length > 0 && (
                          <div className="px-4 py-2 border-t border-white/5">
                            <div className="text-xs text-gray-500 uppercase tracking-wider mb-2">Substitutes</div>
                            <div className="space-y-1">
                              {lineup.substitutes.map((player: FixturePlayer) => (
                                <div key={player.id} className="flex items-center gap-2 text-sm opacity-70">
                                  <span className={`w-6 text-center font-mono ${index === 0 ? 'text-blue-400' : 'text-green-400'}`}>
                                    {player.number || '-'}
                                  </span>
                                  <span className="text-gray-300">{player.player_name}</span>
                                  <span className="text-gray-500 text-xs ml-auto">{player.pos}</span>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                  </>
                )}
            </div>
          </div>
          )}

          {/* Match Events Section */}
          {selectedSection === 'events' && (
          <div className="bg-gradient-to-br from-gray-900/80 to-gray-950/80 rounded-2xl border border-white/5 p-4 sm:p-5 mb-6">
            {/* Header */}
            <div className="flex items-center gap-3 mb-6">
              <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-amber-600 flex items-center justify-center">
                <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
              </div>
              <div>
                <div className="flex items-center gap-2">
                  <h2 className="text-lg font-bold text-white">{t('matchEvents')}</h2>
                  {match.type === 'In Play' && (
                    <div className="flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-red-500/20 border border-red-500/30">
                      <div className="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse" />
                      <span className="text-xs font-medium text-red-400">LIVE</span>
                    </div>
                  )}
                </div>
                <p className="text-xs text-gray-500">{t('eventsTimeline')}</p>
              </div>
            </div>

            {/* Content */}
            <div>
                {/* No events message */}
                {(!events || events.length === 0) ? (
                  <div className="flex flex-col items-center justify-center py-12 text-center">
                    <div className="w-16 h-16 rounded-full bg-gray-800/50 flex items-center justify-center mb-4">
                      <svg className="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M13 10V3L4 14h7v7l9-11h-7z" />
                      </svg>
                    </div>
                    <h3 className="text-white font-medium mb-2">{t('noEvents')}</h3>
                    <p className="text-gray-500 text-sm max-w-md">
                      {t('noEventsDesc')}
                    </p>
                  </div>
                ) : (
                  <div className="relative">
                    {/* Timeline vertical line */}
                    <div className="absolute left-[23px] top-4 bottom-4 w-0.5 bg-gradient-to-b from-orange-500/50 via-amber-500/30 to-orange-500/50" />

                    <div className="space-y-0">
                      {events.map((event: FixtureEvent, index: number) => {
                        // Determine event icon and color based on event_type and event_detail
                        const getEventStyle = () => {
                          const type = event.event_type?.toLowerCase() || '';
                          const detail = event.event_detail?.toLowerCase() || '';

                          if (type === 'goal') {
                            if (detail.includes('own goal')) {
                              return { icon: 'âš½', dotColor: 'bg-red-500', bgColor: 'bg-red-500/10', borderColor: 'border-red-500/20', textColor: 'text-red-400' };
                            }
                            if (detail.includes('penalty')) {
                              return { icon: 'âš½', dotColor: 'bg-emerald-500', bgColor: 'bg-emerald-500/10', borderColor: 'border-emerald-500/20', textColor: 'text-emerald-400' };
                            }
                            return { icon: 'âš½', dotColor: 'bg-emerald-500', bgColor: 'bg-emerald-500/10', borderColor: 'border-emerald-500/20', textColor: 'text-emerald-400' };
                          }
                          if (type === 'card') {
                            if (detail.includes('yellow')) {
                              return { icon: 'ğŸŸ¨', dotColor: 'bg-yellow-500', bgColor: 'bg-yellow-500/10', borderColor: 'border-yellow-500/20', textColor: 'text-yellow-400' };
                            }
                            if (detail.includes('red')) {
                              return { icon: 'ğŸŸ¥', dotColor: 'bg-red-500', bgColor: 'bg-red-500/10', borderColor: 'border-red-500/20', textColor: 'text-red-400' };
                            }
                            return { icon: 'ğŸŸ¨', dotColor: 'bg-yellow-500', bgColor: 'bg-yellow-500/10', borderColor: 'border-yellow-500/20', textColor: 'text-yellow-400' };
                          }
                          if (type === 'subst') {
                            return { icon: 'ğŸ”„', dotColor: 'bg-blue-500', bgColor: 'bg-blue-500/10', borderColor: 'border-blue-500/20', textColor: 'text-blue-400' };
                          }
                          if (type === 'var') {
                            return { icon: 'ğŸ“º', dotColor: 'bg-purple-500', bgColor: 'bg-purple-500/10', borderColor: 'border-purple-500/20', textColor: 'text-purple-400' };
                          }
                          return { icon: 'âš¡', dotColor: 'bg-gray-500', bgColor: 'bg-gray-500/10', borderColor: 'border-gray-500/20', textColor: 'text-gray-400' };
                        };

                        const style = getEventStyle();
                        const isHomeTeam = match && event.team_name === match.home_name;
                        const isFirst = index === 0;
                        const isLast = index === events.length - 1;

                        return (
                          <div
                            key={event.id}
                            className={`relative flex items-start gap-4 ${isFirst ? 'pt-0' : 'pt-3'} ${isLast ? 'pb-0' : 'pb-3'}`}
                          >
                            {/* Timeline dot */}
                            <div className="relative z-10 flex-shrink-0 w-12 flex flex-col items-center">
                              <div className={`w-3 h-3 rounded-full ${style.dotColor} ring-4 ring-gray-900/80`} />
                            </div>

                            {/* Event Card */}
                            <div className={`flex-1 flex items-center gap-3 p-3 rounded-xl ${style.bgColor} border ${style.borderColor}`}>
                              {/* Time */}
                              <div className="flex-shrink-0 w-14 text-center">
                                <span className={`text-lg font-bold ${style.textColor}`}>
                                  {event.elapsed_time || '-'}&apos;
                                </span>
                                {event.extra_time && (
                                  <span className={`text-xs ${style.textColor}`}>+{event.extra_time}</span>
                                )}
                              </div>

                              {/* Event Icon */}
                              <div className="flex-shrink-0 text-2xl">
                                {style.icon}
                              </div>

                              {/* Event Details */}
                              <div className="flex-1 min-w-0">
                                <div className="flex items-center gap-2">
                                  <span className="font-semibold text-white truncate">{event.player_name || 'Unknown'}</span>
                                  {event.assist_name && (
                                    <span className="text-gray-400 text-sm truncate">({event.assist_name})</span>
                                  )}
                                </div>
                                <div className="flex items-center gap-2 text-sm">
                                  <span className={`${isHomeTeam ? 'text-blue-400' : 'text-green-400'}`}>
                                    {event.team_name || 'Unknown Team'}
                                  </span>
                                  {event.event_detail && (
                                    <>
                                      <span className="text-gray-600">â€¢</span>
                                      <span className="text-gray-400">{event.event_detail}</span>
                                    </>
                                  )}
                                </div>
                                {event.comments && (
                                  <p className="text-xs text-gray-500 mt-1 truncate">{event.comments}</p>
                                )}
                              </div>

                              {/* Team indicator */}
                              <div className={`flex-shrink-0 w-1 h-12 rounded-full ${isHomeTeam ? 'bg-blue-500' : 'bg-green-500'}`} />
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}
            </div>
          </div>
          )}

          {/* Odds Section */}
          {selectedSection === 'odds' && (
          <>
          <div className="bg-gradient-to-br from-gray-900/80 to-gray-950/80 rounded-2xl border border-white/5 p-6 mb-6">
            <div className="flex items-center gap-2 mb-6">
              {match.type === 'In Play' && (
                <div className="w-2 h-2 rounded-full bg-red-500 animate-pulse" />
              )}
              {match.type === 'Scheduled' && (
                <svg className="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              )}
              {match.type === 'Finished' && (
                <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              )}
              <h2 className="text-xl font-bold text-white">{getOddsTitle()}</h2>
              {(match.type === 'In Play' || match.type === 'Scheduled') && (
                <div className="ml-2 flex items-center gap-2">
                  <div className={`relative flex items-center gap-2 px-3 py-1.5 rounded-full ${
                    match.type === 'In Play'
                      ? 'bg-red-500/10 border border-red-500/30'
                      : 'bg-emerald-500/10 border border-emerald-500/30'
                  }`}>
                    {/* Progress bar background */}
                    <div className="absolute inset-0 rounded-full overflow-hidden">
                      <div
                        className={`h-full transition-all duration-1000 ease-linear ${
                          match.type === 'In Play'
                            ? 'bg-gradient-to-r from-red-500/30 to-red-400/20'
                            : 'bg-gradient-to-r from-emerald-500/30 to-emerald-400/20'
                        }`}
                        style={{ width: `${(refreshCountdown / 10) * 100}%` }}
                      />
                    </div>
                    {/* Content */}
                    <div className="relative flex items-center gap-2">
                      <svg className={`w-3.5 h-3.5 animate-spin ${match.type === 'In Play' ? 'text-red-400' : 'text-emerald-400'}`} style={{ animationDuration: '2s' }} fill="none" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      <span className={`text-xs font-medium ${match.type === 'In Play' ? 'text-red-400' : 'text-emerald-400'}`}>
                        {t('refreshIn')} <span className={`font-bold ${match.type === 'In Play' ? 'text-red-300' : 'text-emerald-300'}`}>{refreshCountdown}s</span>
                      </span>
                    </div>
                  </div>
                </div>
              )}
              {(match.type === 'Finished' || match.type === 'In Play' || match.type === 'Scheduled') && (
                <button
                  onClick={() => setShowHistoryModal(true)}
                  className="ml-auto px-4 py-2 rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-500 text-black text-sm font-semibold hover:shadow-lg hover:shadow-emerald-500/25 transition-all cursor-pointer"
                >
                  {t('viewOddsHistory')}
                </button>
              )}
            </div>

            {currentOdds ? (
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {/* 1X2 Odds */}
                <div className="bg-white/5 rounded-xl p-4">
                  <h3 className="text-gray-400 text-sm font-medium mb-3">1X2</h3>
                  <div className="grid grid-cols-3 gap-2">
                    <div className={`bg-white/5 rounded-lg p-3 text-center hover:bg-emerald-500/20 transition-all cursor-pointer ${getFlashClass(oddsFlash.moneyline_1x2_home)}`}>
                      <div className="text-xs text-gray-500 mb-1">Home</div>
                      <div className="text-lg font-bold text-white">{currentOdds.moneyline_1x2_home?.toFixed(2) ?? '-'}</div>
                    </div>
                    <div className={`bg-white/5 rounded-lg p-3 text-center hover:bg-emerald-500/20 transition-all cursor-pointer ${getFlashClass(oddsFlash.moneyline_1x2_draw)}`}>
                      <div className="text-xs text-gray-500 mb-1">Draw</div>
                      <div className="text-lg font-bold text-white">{currentOdds.moneyline_1x2_draw?.toFixed(2) ?? '-'}</div>
                    </div>
                    <div className={`bg-white/5 rounded-lg p-3 text-center hover:bg-emerald-500/20 transition-all cursor-pointer ${getFlashClass(oddsFlash.moneyline_1x2_away)}`}>
                      <div className="text-xs text-gray-500 mb-1">Away</div>
                      <div className="text-lg font-bold text-white">{currentOdds.moneyline_1x2_away?.toFixed(2) ?? '-'}</div>
                    </div>
                  </div>
                </div>

                {/* Over/Under Odds */}
                <div className="bg-white/5 rounded-xl p-4">
                  <h3 className="text-gray-400 text-sm font-medium mb-3">Over/Under {currentOdds.totalpoints_main_line ?? '-'}</h3>
                  <div className="grid grid-cols-2 gap-2">
                    <div className={`bg-white/5 rounded-lg p-3 text-center hover:bg-emerald-500/20 transition-all cursor-pointer ${getFlashClass(oddsFlash.totalpoints_over)}`}>
                      <div className="text-xs text-gray-500 mb-1">Over</div>
                      <div className="text-lg font-bold text-white">{currentOdds.totalpoints_over?.toFixed(2) ?? '-'}</div>
                    </div>
                    <div className={`bg-white/5 rounded-lg p-3 text-center hover:bg-emerald-500/20 transition-all cursor-pointer ${getFlashClass(oddsFlash.totalpoints_under)}`}>
                      <div className="text-xs text-gray-500 mb-1">Under</div>
                      <div className="text-lg font-bold text-white">{currentOdds.totalpoints_under?.toFixed(2) ?? '-'}</div>
                    </div>
                  </div>
                </div>

                {/* Handicap Odds */}
                <div className="bg-white/5 rounded-xl p-4">
                  <h3 className="text-gray-400 text-sm font-medium mb-3">Asian Handicap {currentOdds.handicap_main_line !== null && currentOdds.handicap_main_line !== undefined ? (currentOdds.handicap_main_line > 0 ? '+' : '') + currentOdds.handicap_main_line : '-'}</h3>
                  <div className="grid grid-cols-2 gap-2">
                    <div className={`bg-white/5 rounded-lg p-3 text-center hover:bg-emerald-500/20 transition-all cursor-pointer ${getFlashClass(oddsFlash.handicap_home)}`}>
                      <div className="text-xs text-gray-500 mb-1">Home</div>
                      <div className="text-lg font-bold text-white">{currentOdds.handicap_home?.toFixed(2) ?? '-'}</div>
                    </div>
                    <div className={`bg-white/5 rounded-lg p-3 text-center hover:bg-emerald-500/20 transition-all cursor-pointer ${getFlashClass(oddsFlash.handicap_away)}`}>
                      <div className="text-xs text-gray-500 mb-1">Away</div>
                      <div className="text-lg font-bold text-white">{currentOdds.handicap_away?.toFixed(2) ?? '-'}</div>
                    </div>
                  </div>
                </div>
              </div>
            ) : (
              <div className="text-center py-8">
                <div className="text-gray-500">{t('noOddsData')}</div>
              </div>
            )}
          </div>

          {/* Odds History Modal */}
          {showHistoryModal && (
            <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
              {/* Backdrop */}
              <div
                className="absolute inset-0 bg-black/80 backdrop-blur-sm"
                onClick={() => setShowHistoryModal(false)}
              />
              {/* Modal */}
              <div className="relative bg-gradient-to-br from-gray-900 to-gray-950 rounded-2xl border border-white/10 p-6 max-w-5xl w-full max-h-[80vh] flex flex-col overflow-hidden">
                {/* Background glow orbs */}
                <div className="absolute top-0 left-1/4 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none" />
                <div className="absolute top-0 left-1/2 w-64 h-64 bg-cyan-500/10 rounded-full blur-3xl pointer-events-none" />
                <div className="absolute top-0 right-1/4 w-64 h-64 bg-purple-500/10 rounded-full blur-3xl pointer-events-none" />

                <div className="flex items-center justify-between mb-4 relative z-10">
                  <h3 className="text-xl font-bold text-white" style={{textShadow: '0 0 20px rgba(255, 255, 255, 0.3)'}}>{t('oddsHistory')}</h3>
                  <button
                    onClick={() => setShowHistoryModal(false)}
                    className="p-2 rounded-lg hover:bg-white/10 transition-colors cursor-pointer"
                  >
                    <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>

                {oddsHistory.length > 0 ? (
                  <div className="overflow-auto flex-1 relative z-10">
                    <table className="w-full text-sm border-collapse">
                      <thead className="sticky top-0 z-10">
                        {/* Section Headers */}
                        <tr className="bg-[#0d1117]">
                          <th className="py-3 px-3 bg-[#0d1117]"></th>
                          <th colSpan={3} className="py-3 px-2 text-center bg-[#0d1117]">
                            <div className="relative inline-block px-4 py-1 rounded-full" style={{background: 'linear-gradient(180deg, rgba(16, 185, 129, 0.15) 0%, transparent 100%)', boxShadow: '0 0 20px rgba(16, 185, 129, 0.3), inset 0 1px 0 rgba(16, 185, 129, 0.3)'}}>
                              <span className="text-emerald-400 font-bold text-sm tracking-wider" style={{textShadow: '0 0 10px rgba(16, 185, 129, 0.8), 0 0 30px rgba(16, 185, 129, 0.6), 0 0 50px rgba(16, 185, 129, 0.4)'}}>1X2</span>
                            </div>
                          </th>
                          <th colSpan={3} className="py-3 px-2 text-center bg-[#0d1117]">
                            <div className="relative inline-block px-4 py-1 rounded-full" style={{background: 'linear-gradient(180deg, rgba(34, 211, 238, 0.15) 0%, transparent 100%)', boxShadow: '0 0 20px rgba(34, 211, 238, 0.3), inset 0 1px 0 rgba(34, 211, 238, 0.3)'}}>
                              <span className="text-cyan-400 font-bold text-sm tracking-wider" style={{textShadow: '0 0 10px rgba(34, 211, 238, 0.8), 0 0 30px rgba(34, 211, 238, 0.6), 0 0 50px rgba(34, 211, 238, 0.4)'}}>OVER/UNDER</span>
                            </div>
                          </th>
                          <th colSpan={3} className="py-3 px-2 text-center bg-[#0d1117]">
                            <div className="relative inline-block px-4 py-1 rounded-full" style={{background: 'linear-gradient(180deg, rgba(192, 132, 252, 0.15) 0%, transparent 100%)', boxShadow: '0 0 20px rgba(192, 132, 252, 0.3), inset 0 1px 0 rgba(192, 132, 252, 0.3)'}}>
                              <span className="text-purple-400 font-bold text-sm tracking-wider" style={{textShadow: '0 0 10px rgba(192, 132, 252, 0.8), 0 0 30px rgba(192, 132, 252, 0.6), 0 0 50px rgba(192, 132, 252, 0.4)'}}>HANDICAP</span>
                            </div>
                          </th>
                        </tr>
                        {/* Column Headers */}
                        <tr className="bg-[#0d1117]" style={{boxShadow: '0 2px 10px rgba(0, 0, 0, 0.5)'}}>
                          <th className="text-left py-3 px-3 text-gray-400 font-medium bg-[#0d1117]">Time</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]" style={{boxShadow: 'inset 2px 0 0 rgba(16, 185, 129, 0.5)'}}>Home</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]">Draw</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]" style={{boxShadow: 'inset -2px 0 0 rgba(16, 185, 129, 0.5)'}}>Away</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]" style={{boxShadow: 'inset 2px 0 0 rgba(34, 211, 238, 0.5)'}}>Line</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]">Over</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]" style={{boxShadow: 'inset -2px 0 0 rgba(34, 211, 238, 0.5)'}}>Under</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]" style={{boxShadow: 'inset 2px 0 0 rgba(192, 132, 252, 0.5)'}}>Line</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]">Home</th>
                          <th className="text-center py-3 px-2 text-gray-400 font-medium bg-[#0d1117]">Away</th>
                        </tr>
                      </thead>
                      <tbody>
                        {oddsHistory.map((record, index) => (
                          <tr key={record.id} className={`border-b border-white/5 ${index === 0 ? 'bg-emerald-500/10' : 'hover:bg-white/5'} transition-colors`}>
                            <td className="py-3 px-3 text-gray-300 whitespace-nowrap">
                              {formatHistoryTime(record.created_at)}
                              {index === 0 && <span className="ml-2 text-xs text-emerald-400 font-medium" style={{textShadow: '0 0 8px rgba(16, 185, 129, 0.6)'}}>(Latest)</span>}
                            </td>
                            {/* 1X2 Section */}
                            <td className="text-center py-3 px-2 text-white font-medium" style={{boxShadow: 'inset 2px 0 0 rgba(16, 185, 129, 0.4)'}}>{record.moneyline_1x2_home?.toFixed(2) ?? '-'}</td>
                            <td className="text-center py-3 px-2 text-white font-medium">{record.moneyline_1x2_draw?.toFixed(2) ?? '-'}</td>
                            <td className="text-center py-3 px-2 text-white font-medium" style={{boxShadow: 'inset -2px 0 0 rgba(16, 185, 129, 0.4)'}}>{record.moneyline_1x2_away?.toFixed(2) ?? '-'}</td>
                            {/* O/U Section */}
                            <td className="text-center py-3 px-2 font-medium" style={{boxShadow: 'inset 2px 0 0 rgba(34, 211, 238, 0.4)'}}>
                              <span className="text-cyan-400" style={{textShadow: '0 0 8px rgba(34, 211, 238, 0.5)'}}>{record.totalpoints_main_line ?? '-'}</span>
                            </td>
                            <td className="text-center py-3 px-2 text-white font-medium">{record.totalpoints_over?.toFixed(2) ?? '-'}</td>
                            <td className="text-center py-3 px-2 text-white font-medium" style={{boxShadow: 'inset -2px 0 0 rgba(34, 211, 238, 0.4)'}}>{record.totalpoints_under?.toFixed(2) ?? '-'}</td>
                            {/* Handicap Section */}
                            <td className="text-center py-3 px-2 font-medium" style={{boxShadow: 'inset 2px 0 0 rgba(192, 132, 252, 0.4)'}}>
                              <span className="text-purple-400" style={{textShadow: '0 0 8px rgba(192, 132, 252, 0.5)'}}>{record.handicap_main_line ?? '-'}</span>
                            </td>
                            <td className="text-center py-3 px-2 text-white font-medium">{record.handicap_home?.toFixed(2) ?? '-'}</td>
                            <td className="text-center py-3 px-2 text-white font-medium">{record.handicap_away?.toFixed(2) ?? '-'}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    {t('noHistory')}
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Signal History Modal */}
          {showSignalHistory && (
            <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
              {/* Backdrop */}
              <div
                className="absolute inset-0 bg-black/80 backdrop-blur-sm"
                onClick={() => setShowSignalHistory(null)}
              />
              {/* Modal */}
              <div className="relative bg-gradient-to-br from-gray-900 to-gray-950 rounded-2xl border border-white/10 p-6 max-w-5xl w-full max-h-[80vh] flex flex-col overflow-hidden">
                {/* Background glow */}
                <div className="absolute top-0 left-1/4 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none" />
                <div className="absolute top-0 right-1/4 w-64 h-64 bg-cyan-500/10 rounded-full blur-3xl pointer-events-none" />

                <div className="flex items-center justify-between mb-4 relative z-10">
                  <h3 className="text-xl font-bold text-white">
                    Signal History - {showSignalHistory === 'moneyline' ? '1X2' : showSignalHistory === 'overunder' ? 'Over/Under' : showSignalHistory === 'handicap' ? 'Handicap' : `ğŸ’ Value Hunter (${selectedMarket === 'moneyline' ? '1X2' : selectedMarket === 'overunder' ? 'O/U' : 'HDP'})`}
                  </h3>
                  <button
                    onClick={() => setShowSignalHistory(null)}
                    className="p-2 rounded-lg hover:bg-white/10 transition-colors cursor-pointer"
                  >
                    <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>

                <div className="overflow-auto flex-1 relative z-10">
                  {showSignalHistory === 'value' ? (
                    liveSignalsHistory.length > 0 ? (
                      <table className="w-full text-sm border-collapse">
                        <thead className="sticky top-0 bg-[#0d1117]">
                          <tr>
                            <th className="text-left py-3 px-2 text-gray-400 font-medium">Clock</th>
                            <th className="text-left py-3 px-2 text-gray-400 font-medium">Score</th>
                            <th className="text-center py-3 px-2 text-gray-400 font-medium">Selection</th>
                            <th className="text-center py-3 px-2 text-gray-400 font-medium">Fair Odds</th>
                            <th className="text-center py-3 px-2 text-gray-400 font-medium">Market Odds</th>
                            <th className="text-center py-3 px-2 text-gray-400 font-medium">EV</th>
                            <th className="text-center py-3 px-2 text-gray-400 font-medium">Stake</th>
                            <th className="text-center py-3 px-2 text-gray-400 font-medium">Status</th>
                          </tr>
                        </thead>
                        <tbody>
                          {liveSignalsHistory.map((record, index) => {
                            // Get data based on selected market
                            const getSelectionLabel = () => {
                              if (selectedMarket === 'moneyline') {
                                return record.selection_1x2 === '1' ? 'Home' : record.selection_1x2 === 'X' ? 'Draw' : 'Away';
                              } else if (selectedMarket === 'overunder') {
                                return record.selection_ou === 'over' ? 'Over' : 'Under';
                              } else {
                                return record.selection_hdp === 'home' ? 'Home' : 'Away';
                              }
                            };
                            const getFairOdds = () => {
                              if (selectedMarket === 'moneyline') {
                                const idx = record.selection_1x2 === '1' ? 0 : record.selection_1x2 === 'X' ? 1 : 2;
                                return record.fair_odds_1x2?.[idx]?.toFixed(2) ?? '-';
                              } else if (selectedMarket === 'overunder') {
                                return record.selection_ou === 'over' ? record.fair_odds_ou?.[0]?.toFixed(2) ?? '-' : record.fair_odds_ou?.[1]?.toFixed(2) ?? '-';
                              } else {
                                return record.selection_hdp === 'home' ? record.fair_odds_hdp?.[0]?.toFixed(2) ?? '-' : record.fair_odds_hdp?.[1]?.toFixed(2) ?? '-';
                              }
                            };
                            const getMarketOdds = () => {
                              if (selectedMarket === 'moneyline') {
                                const idx = record.selection_1x2 === '1' ? 0 : record.selection_1x2 === 'X' ? 1 : 2;
                                return record.market_odds_1x2?.[idx]?.toFixed(2) ?? '-';
                              } else if (selectedMarket === 'overunder') {
                                return record.selection_ou === 'over' ? record.market_odds_ou?.[0]?.toFixed(2) ?? '-' : record.market_odds_ou?.[1]?.toFixed(2) ?? '-';
                              } else {
                                return record.selection_hdp === 'home' ? record.market_odds_hdp?.[0]?.toFixed(2) ?? '-' : record.market_odds_hdp?.[1]?.toFixed(2) ?? '-';
                              }
                            };
                            const getEV = () => {
                              if (selectedMarket === 'moneyline') {
                                return record.expected_value_1x2 !== null && !isNaN(record.expected_value_1x2) ? `+${record.expected_value_1x2.toFixed(2)}%` : '-';
                              } else if (selectedMarket === 'overunder') {
                                return record.expected_value_ou !== null && !isNaN(record.expected_value_ou) ? `+${record.expected_value_ou.toFixed(2)}%` : '-';
                              } else {
                                return record.expected_value_hdp !== null && !isNaN(record.expected_value_hdp) ? `+${record.expected_value_hdp.toFixed(2)}%` : '-';
                              }
                            };
                            const getStake = () => {
                              if (selectedMarket === 'moneyline') {
                                return record.recommended_stake_1x2 !== null && !isNaN(record.recommended_stake_1x2) ? `${record.recommended_stake_1x2.toFixed(2)} units` : '-';
                              } else if (selectedMarket === 'overunder') {
                                return record.recommended_stake_ou !== null && !isNaN(record.recommended_stake_ou) ? `${record.recommended_stake_ou.toFixed(2)} units` : '-';
                              } else {
                                return record.recommended_stake_hdp !== null && !isNaN(record.recommended_stake_hdp) ? `${record.recommended_stake_hdp.toFixed(2)} units` : '-';
                              }
                            };
                            const isValuable = selectedMarket === 'moneyline' ? record.is_valuable_1x2 : selectedMarket === 'overunder' ? record.is_valuable_ou : record.is_valuable_hdp;

                            return (
                              <tr key={record.id || index} className={`border-b border-white/5 ${index === 0 ? 'bg-purple-500/10' : 'hover:bg-white/5'} transition-colors`}>
                                <td className="py-3 px-2 text-gray-300">{record.clock !== null ? `${record.clock}'` : '-'}</td>
                                <td className="py-3 px-2 text-white font-bold">{record.score || '-'}</td>
                                <td className="py-3 px-2 text-center">
                                  <span className={`px-2 py-1 rounded text-xs font-bold ${
                                    selectedMarket === 'moneyline' ? 'bg-emerald-500/20 text-emerald-400' :
                                    selectedMarket === 'overunder' ? 'bg-cyan-500/20 text-cyan-400' :
                                    'bg-pink-500/20 text-pink-400'
                                  }`}>{getSelectionLabel()}</span>
                                </td>
                                <td className="py-3 px-2 text-center text-gray-400">{getFairOdds()}</td>
                                <td className="py-3 px-2 text-center text-white font-medium">{getMarketOdds()}</td>
                                <td className="py-3 px-2 text-center text-emerald-400 font-medium">{getEV()}</td>
                                <td className="py-3 px-2 text-center text-yellow-400">{getStake()}</td>
                                <td className="py-3 px-2 text-center">
                                  {isValuable ? (
                                    <span className="px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 text-xs font-bold">VALUE</span>
                                  ) : (
                                    <span className="px-2 py-1 rounded bg-gray-500/20 text-gray-400 text-xs">NORMAL</span>
                                  )}
                                </td>
                              </tr>
                            );
                          })}
                        </tbody>
                      </table>
                    ) : (
                      <div className="text-center py-8 text-gray-500">No Value Hunter signal history available</div>
                    )
                  ) : signalHistory[showSignalHistory as 'moneyline' | 'overunder' | 'handicap']?.length > 0 ? (
                    <table className="w-full text-sm border-collapse">
                      <thead className="sticky top-0 bg-[#0d1117]">
                        <tr>
                          <th className="text-left py-3 px-3 text-gray-400 font-medium">Clock</th>
                          <th className="text-left py-3 px-3 text-gray-400 font-medium">Signal</th>
                          <th className="text-left py-3 px-3 text-gray-400 font-medium">Selection</th>
                          {showSignalHistory === 'moneyline' && (
                            <>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Home</th>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Draw</th>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Away</th>
                            </>
                          )}
                          {showSignalHistory === 'overunder' && (
                            <>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Line</th>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Over</th>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Under</th>
                            </>
                          )}
                          {showSignalHistory === 'handicap' && (
                            <>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Line</th>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Home</th>
                              <th className="text-center py-3 px-2 text-gray-400 font-medium">Away</th>
                            </>
                          )}
                          <th className="text-left py-3 px-3 text-gray-400 font-medium">Bookmaker</th>
                          <th className="text-left py-3 px-3 text-gray-400 font-medium">Stacking</th>
                          <th className="text-left py-3 px-3 text-gray-400 font-medium">Vig Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        {signalHistory[showSignalHistory as 'moneyline' | 'overunder' | 'handicap'].map((record, index) => (
                          <tr key={record.id} className={`border-b border-white/5 ${index === 0 ? 'bg-emerald-500/10' : 'hover:bg-white/5'} transition-colors`}>
                            <td className="py-3 px-3 text-gray-300">
                              {record.clock !== null ? `${record.clock}'` : '-'}
                            </td>
                            <td className="py-3 px-3">
                              <span className={`px-2 py-1 rounded text-xs font-medium ${
                                record.signal?.includes('ğŸŸ¢') ? 'bg-emerald-500/20 text-emerald-400' :
                                record.signal?.includes('ğŸ”¥') ? 'bg-orange-500/20 text-orange-400' :
                                record.signal?.includes('ğŸ”µ') ? 'bg-blue-500/20 text-blue-400' :
                                record.signal?.includes('ğŸ”´') ? 'bg-red-500/20 text-red-400' :
                                'bg-gray-500/20 text-gray-400'
                              }`}>
                                {record.signal || '-'}
                              </span>
                            </td>
                            <td className="py-3 px-3 text-white font-medium">{record.selection || '-'}</td>
                            {showSignalHistory === 'moneyline' && (
                              <>
                                <td className="py-3 px-2 text-center text-cyan-400 font-medium">{(record as Moneyline1x2Prediction).moneyline_1x2_home?.toFixed(2) ?? '-'}</td>
                                <td className="py-3 px-2 text-center text-cyan-400 font-medium">{(record as Moneyline1x2Prediction).moneyline_1x2_draw?.toFixed(2) ?? '-'}</td>
                                <td className="py-3 px-2 text-center text-cyan-400 font-medium">{(record as Moneyline1x2Prediction).moneyline_1x2_away?.toFixed(2) ?? '-'}</td>
                              </>
                            )}
                            {showSignalHistory === 'overunder' && (
                              <>
                                <td className="py-3 px-2 text-center text-purple-400 font-medium">{(record as OverUnderPrediction).line ?? '-'}</td>
                                <td className="py-3 px-2 text-center text-cyan-400 font-medium">{(record as OverUnderPrediction).over?.toFixed(2) ?? '-'}</td>
                                <td className="py-3 px-2 text-center text-cyan-400 font-medium">{(record as OverUnderPrediction).under?.toFixed(2) ?? '-'}</td>
                              </>
                            )}
                            {showSignalHistory === 'handicap' && (
                              <>
                                <td className="py-3 px-2 text-center text-purple-400 font-medium">{(record as HandicapPrediction).line ?? '-'}</td>
                                <td className="py-3 px-2 text-center text-cyan-400 font-medium">{(record as HandicapPrediction).home_odds?.toFixed(2) ?? '-'}</td>
                                <td className="py-3 px-2 text-center text-cyan-400 font-medium">{(record as HandicapPrediction).away_odds?.toFixed(2) ?? '-'}</td>
                              </>
                            )}
                            <td className="py-3 px-3 text-gray-300">{record.bookmaker || '-'}</td>
                            <td className="py-3 px-3 text-yellow-400 text-xs">{record.stacking_quantity || '-'}</td>
                            <td className="py-3 px-3 text-gray-400 text-xs">{record.market_analysis_vig_status || '-'}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  ) : (
                    <div className="text-center py-8 text-gray-500">
                      No signal history available
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* Profit Summary Modal */}
          {showProfitModal && (
            <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
              {/* Backdrop */}
              <div
                className="absolute inset-0 bg-black/80 backdrop-blur-sm"
                onClick={() => setShowProfitModal(false)}
              />
              {/* Modal */}
              <div className="relative bg-gradient-to-br from-gray-900 to-gray-950 rounded-2xl border border-white/10 p-6 max-w-lg w-full overflow-hidden">
                {/* Background glow */}
                <div className="absolute top-0 left-1/4 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl pointer-events-none" />
                <div className="absolute top-0 right-1/4 w-64 h-64 bg-cyan-500/10 rounded-full blur-3xl pointer-events-none" />

                <div className="flex items-center justify-between mb-6 relative z-10">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
                      <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                      </svg>
                    </div>
                    <h3 className="text-xl font-bold text-white">Profit Summary</h3>
                  </div>
                  <button
                    onClick={() => setShowProfitModal(false)}
                    className="p-2 rounded-lg hover:bg-white/10 transition-colors cursor-pointer"
                  >
                    <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>

                {profitSummary ? (
                  <div className="relative z-10 space-y-4">
                    {/* Main Stats */}
                    <div className="grid grid-cols-2 gap-3">
                      {/* Total Profit */}
                      <div className="bg-white/5 rounded-xl p-4 border border-white/10">
                        <div className="text-xs text-gray-500 uppercase tracking-wider mb-1">Total Profit</div>
                        <div className={`text-2xl font-bold ${(profitSummary.total_profit ?? 0) >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                          {(profitSummary.total_profit ?? 0) >= 0 ? '+$' : '-$'}{Math.abs(profitSummary.total_profit ?? 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                        </div>
                      </div>
                      {/* ROI */}
                      <div className="bg-white/5 rounded-xl p-4 border border-white/10">
                        <div className="text-xs text-gray-500 uppercase tracking-wider mb-1">ROI</div>
                        <div className={`text-2xl font-bold ${(profitSummary.roi_percentage ?? 0) >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                          {(profitSummary.roi_percentage ?? 0) >= 0 ? '+' : ''}{profitSummary.roi_percentage?.toFixed(2) ?? '0.00'}%
                        </div>
                      </div>
                      {/* Total Invested */}
                      <div className="bg-white/5 rounded-xl p-4 border border-white/10">
                        <div className="text-xs text-gray-500 uppercase tracking-wider mb-1">Total Invested</div>
                        <div className="text-xl font-bold text-white">
                          ${(profitSummary.total_invested ?? 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                        </div>
                      </div>
                      {/* Total Bets */}
                      <div className="bg-white/5 rounded-xl p-4 border border-white/10">
                        <div className="text-xs text-gray-500 uppercase tracking-wider mb-1">Total Bets</div>
                        <div className="text-xl font-bold text-white">
                          {profitSummary.total_bets ?? 0}
                        </div>
                      </div>
                    </div>

                    {/* Market Breakdown */}
                    <div className="bg-white/5 rounded-xl p-4 border border-white/10">
                      <div className="text-xs text-gray-500 uppercase tracking-wider mb-3">Profit by Market</div>
                      <div className="space-y-3">
                        {/* Moneyline */}
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <div className="w-2 h-2 rounded-full bg-cyan-500"></div>
                            <span className="text-gray-300 text-sm">1X2 Moneyline</span>
                          </div>
                          <span className={`font-bold ${(profitSummary.profit_moneyline ?? 0) >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                            {(profitSummary.profit_moneyline ?? 0) >= 0 ? '+$' : '-$'}{Math.abs(profitSummary.profit_moneyline ?? 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                          </span>
                        </div>
                        {/* Handicap */}
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <div className="w-2 h-2 rounded-full bg-purple-500"></div>
                            <span className="text-gray-300 text-sm">Asian Handicap</span>
                          </div>
                          <span className={`font-bold ${(profitSummary.profit_handicap ?? 0) >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                            {(profitSummary.profit_handicap ?? 0) >= 0 ? '+$' : '-$'}{Math.abs(profitSummary.profit_handicap ?? 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                          </span>
                        </div>
                        {/* Over/Under */}
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <div className="w-2 h-2 rounded-full bg-amber-500"></div>
                            <span className="text-gray-300 text-sm">Over/Under</span>
                          </div>
                          <span className={`font-bold ${(profitSummary.profit_ou ?? 0) >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                            {(profitSummary.profit_ou ?? 0) >= 0 ? '+$' : '-$'}{Math.abs(profitSummary.profit_ou ?? 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                          </span>
                        </div>
                      </div>
                    </div>

                    {/* Note */}
                    <div className="text-center text-xs text-gray-500">
                      1 Bet = $100
                    </div>
                  </div>
                ) : (
                  <div className="relative z-10 text-center py-8 text-gray-500">
                    <svg className="w-12 h-12 mx-auto mb-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    <p className="text-sm">No profit summary available</p>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* AI Predictions Section */}
          <div className="bg-gradient-to-br from-gray-900/80 to-gray-950/80 rounded-2xl border border-white/5 p-4 sm:p-5">
            {/* Header Row */}
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-2">
                {match.type === 'In Play' && (
                  <div className="w-2.5 h-2.5 rounded-full bg-red-500 animate-pulse" />
                )}
                <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
                  <svg className="w-4 h-4 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                </div>
                <div>
                  <h2 className="text-lg font-bold text-white">{t('aiPredictions')}</h2>
                  <div className="flex items-center gap-1.5">
                    <span className="text-xs text-gray-500">{currentPersonality.icon} {currentPersonality.name}</span>
                  </div>
                </div>
                {/* Live Refresh Countdown */}
                {match.type === 'In Play' && (
                  <div className="ml-2 relative flex items-center gap-2 px-3 py-1.5 rounded-full bg-red-500/10 border border-red-500/30">
                    {/* Progress bar background */}
                    <div className="absolute inset-0 rounded-full overflow-hidden">
                      <div
                        className="h-full transition-all duration-1000 ease-linear bg-gradient-to-r from-red-500/30 to-red-400/20"
                        style={{ width: `${(refreshCountdown / 10) * 100}%` }}
                      />
                    </div>
                    {/* Content */}
                    <div className="relative flex items-center gap-2">
                      <svg className="w-3.5 h-3.5 animate-spin text-red-400" style={{ animationDuration: '2s' }} fill="none" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      <span className="text-xs font-medium text-red-400">
                        {t('refreshIn')} <span className="font-bold text-red-300">{refreshCountdown}s</span>
                      </span>
                    </div>
                  </div>
                )}
              </div>
              <div className="flex items-center gap-2">
                {/* Profit Summary Button - Only for Finished matches */}
                {match.type === 'Finished' && (
                  <button
                    onClick={openProfitSummary}
                    className="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 border border-emerald-500/30 text-emerald-400 text-xs font-medium hover:from-emerald-500/30 hover:to-cyan-500/30 transition-all cursor-pointer"
                  >
                    <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    Profit Summary
                  </button>
                )}
                <button
                  onClick={() => openSignalHistory(selectedPersonality === 'value' ? 'value' : selectedMarket)}
                  className="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 text-amber-400 text-xs font-medium hover:from-amber-500/30 hover:to-orange-500/30 transition-all cursor-pointer"
                >
                  <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  Signal History
                </button>
              </div>
            </div>

            {/* Personality Quick Select */}
            <div className="flex gap-1.5 mb-4 overflow-x-auto pb-1">
              {PERSONALITIES.map((p) => {
                const available = isStyleAvailable(p.id);
                return (
                  <button
                    key={p.id}
                    onClick={() => available && handlePersonalityChange(p.id)}
                    className={`relative flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-all ${
                      !available
                        ? 'bg-white/5 text-gray-600 cursor-not-allowed opacity-60'
                        : selectedPersonality === p.id
                        ? `bg-gradient-to-r ${p.color} text-black cursor-pointer`
                        : 'bg-white/5 text-gray-400 hover:bg-white/10 cursor-pointer'
                    }`}
                    title={!available ? 'Upgrade to Ultimate to unlock' : ''}
                  >
                    <span>{p.icon}</span>
                    <span>{p.name}</span>
                    {!available && (
                      <svg className="w-3 h-3 ml-0.5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                      </svg>
                    )}
                  </button>
                );
              })}
            </div>

            {/* Market Type Tabs */}
            <div className="flex gap-1 p-1 bg-white/5 rounded-xl mb-4">
              <button
                onClick={() => setSelectedMarket('moneyline')}
                className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all cursor-pointer ${
                  selectedMarket === 'moneyline'
                    ? 'bg-gradient-to-r from-emerald-500 to-cyan-500 text-black'
                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                }`}
              >
                1X2
              </button>
              <button
                onClick={() => setSelectedMarket('overunder')}
                className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all cursor-pointer ${
                  selectedMarket === 'overunder'
                    ? 'bg-gradient-to-r from-cyan-500 to-blue-500 text-black'
                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                }`}
              >
                O/U
              </button>
              <button
                onClick={() => setSelectedMarket('handicap')}
                className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all cursor-pointer ${
                  selectedMarket === 'handicap'
                    ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white'
                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                }`}
              >
                HDP
              </button>
            </div>

            {/* Prediction Card - Compact Design */}
            {selectedMarket === 'moneyline' && (
              <div className="space-y-3">
                {match.type === 'Finished' ? (
                  <div className="text-center py-8 text-gray-500">
                    <div className="space-y-2">
                      <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <p className="text-sm">AI no predictions</p>
                    </div>
                  </div>
                ) : aiPredictions.moneyline ? (
                  <>
                    {/* Signal & Status Row */}
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        {aiPredictions.moneyline.bookmaker && (
                          <span className="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 text-sm font-bold uppercase tracking-wide">
                            {aiPredictions.moneyline.bookmaker}
                          </span>
                        )}
                        {aiPredictions.moneyline.clock !== null && (
                          <div className="flex items-center gap-1.5 px-3 py-1 rounded-lg bg-gradient-to-r from-red-500/20 to-orange-500/20 border border-red-500/30">
                            <svg className="w-4 h-4 text-red-400 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <circle cx="12" cy="12" r="10" strokeWidth="2" />
                              <path strokeLinecap="round" strokeWidth="2" d="M12 6v6l4 2" />
                            </svg>
                            <span className="text-red-400 text-sm font-bold tabular-nums">{aiPredictions.moneyline.clock}'</span>
                          </div>
                        )}
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 border border-emerald-500/30">
                          <svg className="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-emerald-400 font-bold text-base">{aiPredictions.moneyline.selection || '1X2'}</span>
                        </div>
                        <div className={`px-4 py-2 rounded-lg text-base font-bold ${
                          aiPredictions.moneyline.signal?.includes('ğŸŸ¢') ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' :
                          aiPredictions.moneyline.signal?.includes('ğŸ”¥') ? 'bg-orange-500/20 text-orange-400 border border-orange-500/30' :
                          aiPredictions.moneyline.signal?.includes('ğŸ”µ') ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' :
                          aiPredictions.moneyline.signal?.includes('ğŸ”´') ? 'bg-red-500/20 text-red-400 border border-red-500/30' :
                          'bg-gray-500/20 text-gray-400 border border-gray-500/30'
                        }`}>
                          {aiPredictions.moneyline.signal}
                        </div>
                      </div>
                    </div>

                    {/* Compact Odds Grid */}
                    <div className="grid grid-cols-3 gap-2">
                      <div className="bg-white/5 rounded-xl py-3 px-3 text-center">
                        <div className="text-xs text-gray-500 uppercase mb-1">Home</div>
                        <div className="text-xl font-bold text-white">{aiPredictions.moneyline.moneyline_1x2_home?.toFixed(2) ?? '-'}</div>
                      </div>
                      <div className="bg-white/5 rounded-xl py-3 px-3 text-center">
                        <div className="text-xs text-gray-500 uppercase mb-1">Draw</div>
                        <div className="text-xl font-bold text-white">{aiPredictions.moneyline.moneyline_1x2_draw?.toFixed(2) ?? '-'}</div>
                      </div>
                      <div className="bg-white/5 rounded-xl py-3 px-3 text-center">
                        <div className="text-xs text-gray-500 uppercase mb-1">Away</div>
                        <div className="text-xl font-bold text-white">{aiPredictions.moneyline.moneyline_1x2_away?.toFixed(2) ?? '-'}</div>
                      </div>
                    </div>

                    {/* AI Insights Panel */}
                    {(aiPredictions.moneyline.stacking_quantity || aiPredictions.moneyline.market_analysis_trend_direction || aiPredictions.moneyline.market_analysis_vig_status) ? (
                      <div className="rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-white/5 overflow-hidden">
                        {/* Stacking Status */}
                        {(aiPredictions.moneyline.stacking_quantity || aiPredictions.moneyline.market_analysis_vig_status) && (
                          <div className="p-4 border-b border-white/5">
                            <div className="flex items-center justify-between mb-2">
                              <div className="flex items-center gap-2">
                                <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-yellow-500 to-amber-600 flex items-center justify-center">
                                  <span className="text-white text-sm">ğŸ’</span>
                                </div>
                                <div>
                                  <div className="text-xs text-gray-500 uppercase tracking-wider">Staking Plan</div>
                                  <div className="text-yellow-400 font-bold text-base">{aiPredictions.moneyline.stacking_quantity}</div>
                                </div>
                              </div>
                              {aiPredictions.moneyline.market_analysis_vig_status && (
                                <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                                  <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                                  <span className="text-emerald-400 text-xs font-medium">{aiPredictions.moneyline.market_analysis_vig_status}</span>
                                </div>
                              )}
                            </div>
                            {aiPredictions.moneyline.stacking_plan_description && (
                              <p className="text-gray-400 text-sm leading-relaxed line-clamp-2">{aiPredictions.moneyline.stacking_plan_description}</p>
                            )}
                          </div>
                        )}
                        {/* Market Trend */}
                        {aiPredictions.moneyline.market_analysis_trend_direction && (
                          <div className="p-4">
                            <div className="flex items-start gap-3">
                              <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center flex-shrink-0">
                                <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                </svg>
                              </div>
                              <div>
                                <div className="text-xs text-gray-500 uppercase tracking-wider mb-1">Market Performance</div>
                                <p className="text-gray-300 text-sm leading-relaxed">{aiPredictions.moneyline.market_analysis_trend_direction}</p>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    ) : (
                      <div className="rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-white/5 p-6 text-center">
                        <div className="text-gray-500 text-sm">AI no predictions</div>
                      </div>
                    )}
                  </>
                ) : selectedPersonality === 'value' && liveSignals ? (
                  <div className="space-y-3">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        {liveSignals.clock !== null && (
                          <div className="flex items-center gap-1.5 px-3 py-1 rounded-lg bg-gradient-to-r from-red-500/20 to-orange-500/20 border border-red-500/30">
                            <span className="text-red-400 text-sm font-bold">{liveSignals.clock}'</span>
                          </div>
                        )}
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="px-4 py-2 rounded-lg bg-purple-500/20 border border-purple-500/30">
                          <span className="text-purple-400 font-bold">{liveSignals.selection_1x2 === '1' ? 'Home' : liveSignals.selection_1x2 === 'X' ? 'Draw' : 'Away'}</span>
                        </div>
                        {liveSignals.is_valuable_1x2 && (
                          <span className="px-3 py-2 rounded-lg bg-emerald-500/20 text-emerald-400 font-bold border border-emerald-500/30">VALUE BET</span>
                        )}
                      </div>
                    </div>
                    <div className="grid grid-cols-3 gap-2">
                      <div className={`rounded-xl py-3 px-3 text-center ${liveSignals.selection_1x2 === '1' ? 'bg-purple-500/20 border border-purple-500/30' : 'bg-white/5'}`}>
                        <div className="text-xs text-gray-500 uppercase mb-1">Home</div>
                        <div className="text-xs text-gray-400">Fair: {liveSignals.fair_odds_1x2?.[0]?.toFixed(2) ?? '-'}</div>
                        <div className="text-lg font-bold text-white">{liveSignals.market_odds_1x2?.[0]?.toFixed(2) ?? '-'}</div>
                      </div>
                      <div className={`rounded-xl py-3 px-3 text-center ${liveSignals.selection_1x2 === 'X' ? 'bg-purple-500/20 border border-purple-500/30' : 'bg-white/5'}`}>
                        <div className="text-xs text-gray-500 uppercase mb-1">Draw</div>
                        <div className="text-xs text-gray-400">Fair: {liveSignals.fair_odds_1x2?.[1]?.toFixed(2) ?? '-'}</div>
                        <div className="text-lg font-bold text-white">{liveSignals.market_odds_1x2?.[1]?.toFixed(2) ?? '-'}</div>
                      </div>
                      <div className={`rounded-xl py-3 px-3 text-center ${liveSignals.selection_1x2 === '2' ? 'bg-purple-500/20 border border-purple-500/30' : 'bg-white/5'}`}>
                        <div className="text-xs text-gray-500 uppercase mb-1">Away</div>
                        <div className="text-xs text-gray-400">Fair: {liveSignals.fair_odds_1x2?.[2]?.toFixed(2) ?? '-'}</div>
                        <div className="text-lg font-bold text-white">{liveSignals.market_odds_1x2?.[2]?.toFixed(2) ?? '-'}</div>
                      </div>
                    </div>
                    <div className="rounded-xl bg-purple-900/30 border border-purple-500/20 p-4">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          {liveSignals.expected_value_1x2 !== null && !isNaN(liveSignals.expected_value_1x2) && (
                            <div><div className="text-xs text-gray-500">EV</div><div className="text-emerald-400 font-bold">+{(liveSignals.expected_value_1x2 * 100).toFixed(1)}%</div></div>
                          )}
                          {liveSignals.score && (<div><div className="text-xs text-gray-500">Score</div><div className="text-white font-bold">{liveSignals.score}</div></div>)}
                        </div>
                        {liveSignals.recommended_stake_1x2 !== null && !isNaN(liveSignals.recommended_stake_1x2) && (
                          <div className="px-4 py-2 rounded-lg bg-yellow-500/20 border border-yellow-500/30">
                            <div className="text-xs text-gray-400">Stake</div>
                            <div className="text-yellow-400 font-bold">{liveSignals.recommended_stake_1x2.toFixed(2)} units</div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    {match.type === 'Scheduled' ? (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p className="text-sm">Match has not started yet</p>
                      </div>
                    ) : match.type === 'Finished' ? (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p className="text-sm">Match has ended</p>
                      </div>
                    ) : (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                        </svg>
                        <p className="text-sm">AI no predictions</p>
                      </div>
                    )}
                  </div>
                )}
              </div>
            )}

            {selectedMarket === 'overunder' && (
              <div className="space-y-3">
                {match.type === 'Finished' ? (
                  <div className="text-center py-8 text-gray-500">
                    <div className="space-y-2">
                      <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <p className="text-sm">AI no predictions</p>
                    </div>
                  </div>
                ) : aiPredictions.overunder ? (
                  <>
                    {/* Signal & Status Row */}
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        {aiPredictions.overunder.bookmaker && (
                          <span className="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 text-sm font-bold uppercase tracking-wide">
                            {aiPredictions.overunder.bookmaker}
                          </span>
                        )}
                        {aiPredictions.overunder.clock !== null && (
                          <div className="flex items-center gap-1.5 px-3 py-1 rounded-lg bg-gradient-to-r from-red-500/20 to-orange-500/20 border border-red-500/30">
                            <svg className="w-4 h-4 text-red-400 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <circle cx="12" cy="12" r="10" strokeWidth="2" />
                              <path strokeLinecap="round" strokeWidth="2" d="M12 6v6l4 2" />
                            </svg>
                            <span className="text-red-400 text-sm font-bold tabular-nums">{aiPredictions.overunder.clock}'</span>
                          </div>
                        )}
                      </div>
                      <div className="flex items-center gap-3">
                        {(aiPredictions.overunder.selection || aiPredictions.overunder.line !== null) && (
                          <div className="flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-cyan-500/20 to-blue-500/20 border border-cyan-500/30">
                            <svg className="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-cyan-400 font-bold text-base">
                              {aiPredictions.overunder.selection || `O/U ${aiPredictions.overunder.line}`}
                            </span>
                          </div>
                        )}
                        <div className={`px-4 py-2 rounded-lg text-base font-bold ${
                          aiPredictions.overunder.signal?.includes('ğŸŸ¢') ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' :
                          aiPredictions.overunder.signal?.includes('ğŸ”¥') ? 'bg-orange-500/20 text-orange-400 border border-orange-500/30' :
                          aiPredictions.overunder.signal?.includes('ğŸ”µ') ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' :
                          aiPredictions.overunder.signal?.includes('ğŸ”´') ? 'bg-red-500/20 text-red-400 border border-red-500/30' :
                          'bg-gray-500/20 text-gray-400 border border-gray-500/30'
                        }`}>
                          {aiPredictions.overunder.signal}
                        </div>
                      </div>
                    </div>

                    {/* Line Display */}
                    {aiPredictions.overunder.line !== null && (
                      <div className="flex items-center justify-center gap-2 py-2 px-4 rounded-lg bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border border-cyan-500/20">
                        <span className="text-gray-400 text-sm">Line</span>
                        <span className="text-cyan-400 font-bold text-lg">{aiPredictions.overunder.line}</span>
                      </div>
                    )}

                    {/* Compact Odds Grid */}
                    <div className="grid grid-cols-2 gap-2">
                      <div className="bg-white/5 rounded-xl py-3 px-3 text-center">
                        <div className="text-xs text-gray-500 uppercase mb-1">Over</div>
                        <div className="text-xl font-bold text-white">{aiPredictions.overunder.over?.toFixed(2) ?? '-'}</div>
                      </div>
                      <div className="bg-white/5 rounded-xl py-3 px-3 text-center">
                        <div className="text-xs text-gray-500 uppercase mb-1">Under</div>
                        <div className="text-xl font-bold text-white">{aiPredictions.overunder.under?.toFixed(2) ?? '-'}</div>
                      </div>
                    </div>

                    {/* AI Insights Panel */}
                    {(aiPredictions.overunder.stacking_quantity || aiPredictions.overunder.market_analysis_trend_direction || aiPredictions.overunder.market_analysis_vig_status) ? (
                      <div className="rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-white/5 overflow-hidden">
                        {/* Staking Plan */}
                        {(aiPredictions.overunder.stacking_quantity || aiPredictions.overunder.stacking_plan_description || aiPredictions.overunder.market_analysis_vig_status) && (
                          <div className="p-4 border-b border-white/5">
                            <div className="flex items-center justify-between mb-3">
                              <div className="flex items-center gap-2">
                                <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-yellow-500 to-amber-600 flex items-center justify-center">
                                  <span className="text-white text-sm">ğŸ’</span>
                                </div>
                                <div>
                                  <div className="text-xs text-gray-500 uppercase tracking-wider">Staking Plan</div>
                                  <div className="text-yellow-400 font-bold">{aiPredictions.overunder.stacking_quantity || '-'}</div>
                                </div>
                              </div>
                              {aiPredictions.overunder.market_analysis_vig_status && (
                                <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                                  <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                                  <span className="text-emerald-400 text-xs font-medium">{aiPredictions.overunder.market_analysis_vig_status}</span>
                                </div>
                              )}
                            </div>
                            {aiPredictions.overunder.stacking_plan_description && (
                              <p className="text-gray-400 text-sm leading-relaxed line-clamp-2">{aiPredictions.overunder.stacking_plan_description}</p>
                            )}
                          </div>
                        )}
                        {/* Market Trend */}
                        {aiPredictions.overunder.market_analysis_trend_direction && (
                          <div className="p-4">
                            <div className="flex items-start gap-3">
                              <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center flex-shrink-0">
                                <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                </svg>
                              </div>
                              <div>
                                <div className="text-xs text-gray-500 uppercase tracking-wider mb-1">Market Performance</div>
                                <p className="text-gray-300 text-sm leading-relaxed">{aiPredictions.overunder.market_analysis_trend_direction}</p>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    ) : (
                      <div className="rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-white/5 p-6 text-center">
                        <div className="text-gray-500 text-sm">AI no predictions</div>
                      </div>
                    )}
                  </>
                ) : selectedPersonality === 'value' && liveSignals ? (
                  <div className="space-y-3">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        {liveSignals.clock !== null && (
                          <div className="flex items-center gap-1.5 px-3 py-1 rounded-lg bg-gradient-to-r from-red-500/20 to-orange-500/20 border border-red-500/30">
                            <span className="text-red-400 text-sm font-bold">{liveSignals.clock}'</span>
                          </div>
                        )}
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="px-4 py-2 rounded-lg bg-cyan-500/20 border border-cyan-500/30">
                          <span className="text-cyan-400 font-bold">{liveSignals.selection_ou === 'over' ? 'Over' : 'Under'}</span>
                        </div>
                        {liveSignals.is_valuable_ou && (
                          <span className="px-3 py-2 rounded-lg bg-emerald-500/20 text-emerald-400 font-bold border border-emerald-500/30">VALUE BET</span>
                        )}
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-2">
                      <div className={`rounded-xl py-3 px-3 text-center ${liveSignals.selection_ou === 'over' ? 'bg-cyan-500/20 border border-cyan-500/30' : 'bg-white/5'}`}>
                        <div className="text-xs text-gray-500 uppercase mb-1">Over</div>
                        <div className="text-xs text-gray-400">Fair: {liveSignals.fair_odds_ou?.[0]?.toFixed(2) ?? '-'}</div>
                        <div className="text-lg font-bold text-white">{liveSignals.market_odds_ou?.[0]?.toFixed(2) ?? '-'}</div>
                      </div>
                      <div className={`rounded-xl py-3 px-3 text-center ${liveSignals.selection_ou === 'under' ? 'bg-cyan-500/20 border border-cyan-500/30' : 'bg-white/5'}`}>
                        <div className="text-xs text-gray-500 uppercase mb-1">Under</div>
                        <div className="text-xs text-gray-400">Fair: {liveSignals.fair_odds_ou?.[1]?.toFixed(2) ?? '-'}</div>
                        <div className="text-lg font-bold text-white">{liveSignals.market_odds_ou?.[1]?.toFixed(2) ?? '-'}</div>
                      </div>
                    </div>
                    <div className="rounded-xl bg-cyan-900/30 border border-cyan-500/20 p-4">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          {liveSignals.expected_value_ou !== null && !isNaN(liveSignals.expected_value_ou) && (
                            <div><div className="text-xs text-gray-500">EV</div><div className="text-emerald-400 font-bold">+{(liveSignals.expected_value_ou * 100).toFixed(1)}%</div></div>
                          )}
                          {liveSignals.score && (<div><div className="text-xs text-gray-500">Score</div><div className="text-white font-bold">{liveSignals.score}</div></div>)}
                        </div>
                        {liveSignals.recommended_stake_ou !== null && !isNaN(liveSignals.recommended_stake_ou) && (
                          <div className="px-4 py-2 rounded-lg bg-yellow-500/20 border border-yellow-500/30">
                            <div className="text-xs text-gray-400">Stake</div>
                            <div className="text-yellow-400 font-bold">{liveSignals.recommended_stake_ou.toFixed(2)} units</div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    {match.type === 'Scheduled' ? (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p className="text-sm">Match has not started yet</p>
                      </div>
                    ) : match.type === 'Finished' ? (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p className="text-sm">Match has ended</p>
                      </div>
                    ) : (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                        </svg>
                        <p className="text-sm">AI no predictions</p>
                      </div>
                    )}
                  </div>
                )}
              </div>
            )}

            {selectedMarket === 'handicap' && (
              <div className="space-y-3">
                {match.type === 'Finished' ? (
                  <div className="text-center py-8 text-gray-500">
                    <div className="space-y-2">
                      <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <p className="text-sm">AI no predictions</p>
                    </div>
                  </div>
                ) : aiPredictions.handicap ? (
                  <>
                    {/* Signal & Status Row */}
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        {aiPredictions.handicap.bookmaker && (
                          <span className="px-3 py-1 rounded-lg bg-blue-500/20 text-blue-400 text-sm font-bold uppercase tracking-wide">
                            {aiPredictions.handicap.bookmaker}
                          </span>
                        )}
                        {aiPredictions.handicap.clock !== null && (
                          <div className="flex items-center gap-1.5 px-3 py-1 rounded-lg bg-gradient-to-r from-red-500/20 to-orange-500/20 border border-red-500/30">
                            <svg className="w-4 h-4 text-red-400 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <circle cx="12" cy="12" r="10" strokeWidth="2" />
                              <path strokeLinecap="round" strokeWidth="2" d="M12 6v6l4 2" />
                            </svg>
                            <span className="text-red-400 text-sm font-bold tabular-nums">{aiPredictions.handicap.clock}'</span>
                          </div>
                        )}
                      </div>
                      <div className="flex items-center gap-3">
                        {(aiPredictions.handicap.selection || aiPredictions.handicap.line !== null) && (
                          <div className="flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30">
                            <svg className="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-purple-400 font-bold text-base">
                              {aiPredictions.handicap.selection || `HDP ${aiPredictions.handicap.line !== null && aiPredictions.handicap.line > 0 ? '+' : ''}${aiPredictions.handicap.line}`}
                            </span>
                          </div>
                        )}
                        <div className={`px-4 py-2 rounded-lg text-base font-bold ${
                          aiPredictions.handicap.signal?.includes('ğŸŸ¢') ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' :
                          aiPredictions.handicap.signal?.includes('ğŸ”¥') ? 'bg-orange-500/20 text-orange-400 border border-orange-500/30' :
                          aiPredictions.handicap.signal?.includes('ğŸ”µ') ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' :
                          aiPredictions.handicap.signal?.includes('ğŸ”´') ? 'bg-red-500/20 text-red-400 border border-red-500/30' :
                          'bg-gray-500/20 text-gray-400 border border-gray-500/30'
                        }`}>
                          {aiPredictions.handicap.signal}
                        </div>
                      </div>
                    </div>

                    {/* Line Display */}
                    {aiPredictions.handicap.line !== null && (
                      <div className="flex items-center justify-center gap-2 py-2 px-4 rounded-lg bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20">
                        <span className="text-gray-400 text-sm">Line</span>
                        <span className="text-purple-400 font-bold text-lg">{aiPredictions.handicap.line > 0 ? '+' : ''}{aiPredictions.handicap.line}</span>
                      </div>
                    )}

                    {/* Compact Odds Grid */}
                    <div className="grid grid-cols-2 gap-2">
                      <div className="bg-white/5 rounded-xl py-3 px-3 text-center">
                        <div className="text-xs text-gray-500 uppercase mb-1">Home</div>
                        <div className="text-xl font-bold text-white">{aiPredictions.handicap.home_odds?.toFixed(2) ?? '-'}</div>
                      </div>
                      <div className="bg-white/5 rounded-xl py-3 px-3 text-center">
                        <div className="text-xs text-gray-500 uppercase mb-1">Away</div>
                        <div className="text-xl font-bold text-white">{aiPredictions.handicap.away_odds?.toFixed(2) ?? '-'}</div>
                      </div>
                    </div>

                    {/* AI Insights Panel */}
                    {(aiPredictions.handicap.stacking_quantity || aiPredictions.handicap.market_analysis_trend_direction || aiPredictions.handicap.market_analysis_vig_status) ? (
                      <div className="rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-white/5 overflow-hidden">
                        {/* Staking Plan */}
                        {(aiPredictions.handicap.stacking_quantity || aiPredictions.handicap.stacking_plan_description || aiPredictions.handicap.market_analysis_vig_status) && (
                          <div className="p-4 border-b border-white/5">
                            <div className="flex items-center justify-between mb-3">
                              <div className="flex items-center gap-2">
                                <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-yellow-500 to-amber-600 flex items-center justify-center">
                                  <span className="text-white text-sm">ğŸ’</span>
                                </div>
                                <div>
                                  <div className="text-xs text-gray-500 uppercase tracking-wider">Staking Plan</div>
                                  <div className="text-yellow-400 font-bold">{aiPredictions.handicap.stacking_quantity || '-'}</div>
                                </div>
                              </div>
                              {aiPredictions.handicap.market_analysis_vig_status && (
                                <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                                  <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                                  <span className="text-emerald-400 text-xs font-medium">{aiPredictions.handicap.market_analysis_vig_status}</span>
                                </div>
                              )}
                            </div>
                            {aiPredictions.handicap.stacking_plan_description && (
                              <p className="text-gray-400 text-sm leading-relaxed line-clamp-2">{aiPredictions.handicap.stacking_plan_description}</p>
                            )}
                          </div>
                        )}
                        {/* Market Trend */}
                        {aiPredictions.handicap.market_analysis_trend_direction && (
                          <div className="p-4">
                            <div className="flex items-start gap-3">
                              <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center flex-shrink-0">
                                <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                </svg>
                              </div>
                              <div>
                                <div className="text-xs text-gray-500 uppercase tracking-wider mb-1">Market Performance</div>
                                <p className="text-gray-300 text-sm leading-relaxed">{aiPredictions.handicap.market_analysis_trend_direction}</p>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    ) : (
                      <div className="rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-white/5 p-6 text-center">
                        <div className="text-gray-500 text-sm">AI no predictions</div>
                      </div>
                    )}
                  </>
                ) : selectedPersonality === 'value' && liveSignals ? (
                  <div className="space-y-3">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        {liveSignals.clock !== null && (
                          <div className="flex items-center gap-1.5 px-3 py-1 rounded-lg bg-gradient-to-r from-red-500/20 to-orange-500/20 border border-red-500/30">
                            <span className="text-red-400 text-sm font-bold">{liveSignals.clock}'</span>
                          </div>
                        )}
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="px-4 py-2 rounded-lg bg-pink-500/20 border border-pink-500/30">
                          <span className="text-pink-400 font-bold">{liveSignals.selection_hdp === 'home' ? 'Home' : 'Away'}</span>
                        </div>
                        {liveSignals.is_valuable_hdp && (
                          <span className="px-3 py-2 rounded-lg bg-emerald-500/20 text-emerald-400 font-bold border border-emerald-500/30">VALUE BET</span>
                        )}
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-2">
                      <div className={`rounded-xl py-3 px-3 text-center ${liveSignals.selection_hdp === 'home' ? 'bg-pink-500/20 border border-pink-500/30' : 'bg-white/5'}`}>
                        <div className="text-xs text-gray-500 uppercase mb-1">Home</div>
                        <div className="text-xs text-gray-400">Fair: {liveSignals.fair_odds_hdp?.[0]?.toFixed(2) ?? '-'}</div>
                        <div className="text-lg font-bold text-white">{liveSignals.market_odds_hdp?.[0]?.toFixed(2) ?? '-'}</div>
                      </div>
                      <div className={`rounded-xl py-3 px-3 text-center ${liveSignals.selection_hdp === 'away' ? 'bg-pink-500/20 border border-pink-500/30' : 'bg-white/5'}`}>
                        <div className="text-xs text-gray-500 uppercase mb-1">Away</div>
                        <div className="text-xs text-gray-400">Fair: {liveSignals.fair_odds_hdp?.[1]?.toFixed(2) ?? '-'}</div>
                        <div className="text-lg font-bold text-white">{liveSignals.market_odds_hdp?.[1]?.toFixed(2) ?? '-'}</div>
                      </div>
                    </div>
                    <div className="rounded-xl bg-pink-900/30 border border-pink-500/20 p-4">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          {liveSignals.expected_value_hdp !== null && !isNaN(liveSignals.expected_value_hdp) && (
                            <div><div className="text-xs text-gray-500">EV</div><div className="text-emerald-400 font-bold">+{(liveSignals.expected_value_hdp * 100).toFixed(1)}%</div></div>
                          )}
                          {liveSignals.score && (<div><div className="text-xs text-gray-500">Score</div><div className="text-white font-bold">{liveSignals.score}</div></div>)}
                        </div>
                        {liveSignals.recommended_stake_hdp !== null && !isNaN(liveSignals.recommended_stake_hdp) && (
                          <div className="px-4 py-2 rounded-lg bg-yellow-500/20 border border-yellow-500/30">
                            <div className="text-xs text-gray-400">Stake</div>
                            <div className="text-yellow-400 font-bold">{liveSignals.recommended_stake_hdp.toFixed(2)} units</div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    {match.type === 'Scheduled' ? (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p className="text-sm">Match has not started yet</p>
                      </div>
                    ) : match.type === 'Finished' ? (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p className="text-sm">Match has ended</p>
                      </div>
                    ) : (
                      <div className="space-y-2">
                        <svg className="w-10 h-10 mx-auto text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                        </svg>
                        <p className="text-sm">AI no predictions</p>
                      </div>
                    )}
                  </div>
                )}
              </div>
            )}

            {/* Disclaimer Ticker */}
            <div className="mt-6 rounded-xl bg-gradient-to-r from-yellow-500/10 via-orange-500/10 to-yellow-500/10 border border-yellow-500/20 overflow-hidden">
              <div className="py-3 px-4 flex items-center">
                <div className="flex-shrink-0 mr-4">
                  <span className="text-yellow-400 text-lg animate-pulse">âš ï¸</span>
                </div>
                <div className="overflow-hidden flex-1">
                  <div className="animate-marquee whitespace-nowrap">
                    <span className="text-yellow-400/90 text-sm font-medium">
                      {t('disclaimer')} &nbsp;&nbsp;&nbsp;â€¢&nbsp;&nbsp;&nbsp; {t('disclaimer')} &nbsp;&nbsp;&nbsp;â€¢&nbsp;&nbsp;&nbsp; {t('disclaimer')}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          </>
          )}
        </div>
      </main>

      {/* Footer */}
      <footer className="py-8 px-4 border-t border-white/5">
        <div className="max-w-7xl mx-auto text-center text-gray-500 text-sm">
          <p>&copy; 2026 OddsFlow. All rights reserved. Gambling involves risk. Please gamble responsibly.</p>
        </div>
      </footer>
    </div>
  );
}
